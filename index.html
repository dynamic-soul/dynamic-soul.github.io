<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.0.6" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.0.6">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.0.6">


  <link rel="mask-icon" href="/images/logo.svg?v=6.0.6" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.0.6',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="我希望时间没有流走，世界还停在过去，昏黄的光还照在旧日的路上，我刚刚走过，恰与你们相识。">
<meta property="og:type" content="website">
<meta property="og:title" content="Dynamic-Soul">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Dynamic-Soul">
<meta property="og:description" content="我希望时间没有流走，世界还停在过去，昏黄的光还照在旧日的路上，我刚刚走过，恰与你们相识。">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dynamic-Soul">
<meta name="twitter:description" content="我希望时间没有流走，世界还停在过去，昏黄的光还照在旧日的路上，我刚刚走过，恰与你们相识。">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Dynamic-Soul</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <a href="https://github.com/dynamic-soul"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"> 

<div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dynamic-Soul</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        
          
  <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
</li>

      
        
        
          
  <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
</li>

      

      
    </ul>
  

  

  
</nav>


  



 </div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/10/01/2018100122/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dynamic-Soul">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/01/2018100122/" itemprop="url">Python模块和包</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-10-01T22:06:50+08:00">2018-10-01</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/模块化/" itemprop="url" rel="index"><span itemprop="name">模块化</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是模块？"><a href="#什么是模块？" class="headerlink" title="什么是模块？"></a>什么是模块？</h1><p>在计算机程序的开发过程中，随着程序代码越写越多，在一个文件里代码就会越来越长，越来越不容易维护。</p>
<p>为了编写可维护的代码，我们把很多函数分组，分别放到不同的文件里，这样，每个文件包含的代码就相对较少，很多编程语言都采用这种组织代码的方式。</p>
<p>在Python中，一个.py文件就称之为一个模块（Module）。</p>
<h2 id="使用模块有什么好处？"><a href="#使用模块有什么好处？" class="headerlink" title="使用模块有什么好处？"></a>使用模块有什么好处？</h2><pre><code>1.最大的好处是大大提高了代码的可维护性。其次，编写代码不必从零开始。当一个模块编写完毕，就可以被其他地方引用。
</code></pre><p>　　      我们在编写程序的时候，也经常引用其他模块，包括Python内置的模块和来自第三方的模块。</p>
<p>　　   2.使用模块还可以避免函数名和变量名冲突。每个模块有独立的命名空间，</p>
<pre><code>因此相同名字的函数和变量完全可以分别存在不同的模块中。

所以，我们自己在编写模块时，不必考虑名字会与其他模块冲突
</code></pre><h2 id="模块分类"><a href="#模块分类" class="headerlink" title="模块分类"></a>模块分类</h2><p>模块分为三种：</p>
<ul>
<li>内置标准模块（又称标准库）执行help(‘modules’)查看所有python自带模块列表</li>
<li>第三方开源模块，可通过pip install 模块名 联网安装</li>
<li>自定义模块</li>
</ul>
<h1 id="模块调用"><a href="#模块调用" class="headerlink" title="模块调用"></a>模块调用</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> module</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> module <span class="keyword">import</span> xx</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> module.xx.xx <span class="keyword">import</span> xx <span class="keyword">as</span> rename  </span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> module.xx.xx <span class="keyword">import</span> *</span><br></pre></td></tr></table></figure>
<p>1.import….</p>
<p>一个py文件就可以作为一个模块</p>
<p>模块的导入：直接导入文件的名字，不需要带着后缀</p>
<p>模块中的函数调用：模块名.函数名（）</p>
<p>导入模块的时候做了三件事：1.首先开辟了一个新的命名空间my_moudle</p>
<p>　　　　　　　　　　　　　   2.执行了my_moudle内的代码</p>
<p>　　　　　　　　　　　　　  3.将my_moudle里面的名字和命名空间绑定在一起了</p>
<p>注意：模块在一个程序中只会被导入一次，不会重复导入（为了节约资源）那么，如何实现模块在程序中只会被导入一次呢？</p>
<p>当导入一个文件之后，会将模块存储在内存中，当再次导入的时候，就会到内存中查看是否导入过这个模块，如果已经导入过了，就不用再导入了。是通过sys里面的module方法<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> sys.modules:  <span class="comment">#查看是否导入过这个模块</span></span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure></p>
<p> 2.from …import…（也支持别名）</p>
<p>这种形式导入啥就能用啥，不导入的一律不能用</p>
<p>这个被import导入的名字就相当于属于全局变量了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xx <span class="keyword">import</span> read1</span><br><span class="line">read1()</span><br><span class="line"><span class="keyword">from</span> xx <span class="keyword">import</span> read2</span><br><span class="line">read2()</span><br></pre></td></tr></table></figure></p>
<p>需要特别强调的一点是：python中的变量赋值不是一种存储操作，而只是一种绑定关系，如下：</p>
<p> zz.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">money = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_money</span><span class="params">()</span>:</span></span><br><span class="line">    print(money)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> zz <span class="keyword">import</span> money,read_money</span><br><span class="line">print(<span class="string">'修改前money'</span>, money)</span><br><span class="line">money = <span class="number">200</span>  <span class="comment"># 将当前位置的名字money绑定到了200</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'修改后money'</span>, money)  <span class="comment"># 打印当前的名字</span></span><br><span class="line"></span><br><span class="line">read_money()   <span class="comment"># 读取zz.py中的名字money, 仍然为100</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">修改前money 100</span></span><br><span class="line"><span class="string">修改后money 200</span></span><br><span class="line"><span class="string">100</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<p>from…import *</p>
<p>*与all一起用的，首先会把模块中的所有不是‘_’开头的内容导入进来</p>
<p>可以通过<strong>all</strong>来控制导入的内容，但是只和*有关</p>
<p><em>和<strong>all</strong>配合：<strong>all</strong>[‘read1’,’read2’]，all里面导入什么，</em>里面就有什么，如果不用all，就都导入进来了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> zz <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> zz <span class="keyword">import</span> _x</span><br><span class="line"></span><br><span class="line">print(read_money)</span><br><span class="line">print(_x)</span><br><span class="line">print(money)</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">&lt;function read_money at 0x00000000029A6598&gt;</span></span><br><span class="line"><span class="string">2</span></span><br><span class="line"><span class="string">100</span></span><br><span class="line"><span class="string">"""</span></span><br></pre></td></tr></table></figure>
<p>3.模块搜索路径</p>
<p>模块的查找顺序是：内存中已经加载的模块-&gt;内置模块-&gt;sys.path路径中包含的模块</p>
<p>lib里面放的是内置模块</p>
<p>扩展模块一般在site-packages中</p>
<p>sys.path：注意：搜索时按照sys.path中从左到右的顺序查找，位于前的优先被查找，sys.path中还可能包含.zip归档文件和.egg文件，python会把.zip归档文件当成一个目录去处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">print(sys.path)</span><br><span class="line">[<span class="string">''</span>, <span class="string">'/Library/Frameworks/Python.framework/Versions/3.6/lib/python36.zip'</span>, </span><br><span class="line"><span class="string">'/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6'</span>, </span><br><span class="line"><span class="string">'/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/lib-dynload'</span>, </span><br><span class="line"><span class="string">'/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/site-packages'</span>]</span><br></pre></td></tr></table></figure>
<p>python解释器会按照列表顺序去依次到每个目录下去匹配你要导入的模块名，只要在一个目录下匹配到了该模块名，就立刻导入，不再继续往后找。</p>
<p>注意列表第一个元素为空，即代表当前目录，所以你自己定义的模块在当前目录会被优先导入。</p>
<p>千万不要自己定义这些你熟悉的模块或关键字啊啥的作为自己的模块名</p>
<p>比如你导入模块os ,你的文件名就不能叫os.py</p>
<p>4.编译python文件</p>
<p>为了提高加载模块的速度，强调：提高的是加载速度而绝非运行速度。python解释器会在<strong>pycache</strong>目录中下缓存每个模块编译后的版本，</p>
<p>格式为：module.version.pyc。通常会包含python的版本号。</p>
<p>1.以pyc为后缀的就为编译文件</p>
<p>2.编译pyc文件的时候，只有在导入文件的时候才做（就是作为一个模块的时候他才去编译）</p>
<h2 id="开源模块安装、使用"><a href="#开源模块安装、使用" class="headerlink" title="开源模块安装、使用"></a>开源模块安装、使用</h2><p><a href="https://pypi.python.org/pypi" target="_blank" rel="noopener">https://pypi.python.org/pypi</a> 是python的开源模块库，截止2017年9.30日 ，已经收录了118170个来自全世界python开发者贡献的模块,</p>
<p>几乎涵盖了你想用python做的任何事情。 事实上每个python开发者，只要注册一个账号就可以往这个平台上传你自己的模块，这样全世界的开发者都可以容易的下载并使用你的模块。</p>
<p>那如何从这个平台上下载代码呢？</p>
<p>1.直接在上面这个页面上点download,下载后，解压并进入目录，执行以下命令完成安装<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">编译源码    python setup.py build</span><br><span class="line">安装源码    python setup.py install</span><br></pre></td></tr></table></figure></p>
<p>2.直接通过pip安装<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install paramiko <span class="comment">#paramiko 是模块名</span></span><br></pre></td></tr></table></figure></p>
<p>pip命令会自动下载模块包并完成安装。</p>
<p>软件一般会被自动安装你python安装目录的这个子目录里<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/your_python_install_path/<span class="number">3.6</span>/lib/python3<span class="number">.6</span>/site-packages</span><br></pre></td></tr></table></figure></p>
<p>pip命令默认会连接在国外的python官方服务器下载，速度比较慢，你还可以使用国内的豆瓣源，数据会定期同步国外官网，速度快好多<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo pip install -i http://pypi.douban.com/simple/ alex_sayhi --trusted-host pypi.douban.com   <span class="comment">#alex_sayhi是模块名</span></span><br></pre></td></tr></table></figure></p>
<p>使用</p>
<p>下载后，直接导入使用就可以，跟自带的模块调用方法无差，演示一个连接linux执行命令的模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> paramiko</span><br><span class="line"></span><br><span class="line">ssh = paramiko.SSHClient()</span><br><span class="line">ssh.set_missing_host_key_policy(paramiko.AutoAddPolicy())</span><br><span class="line">ssh.connect(<span class="string">'192.168.1.108'</span>, <span class="number">22</span>, <span class="string">'aa'</span>, <span class="string">'123'</span>)</span><br><span class="line"></span><br><span class="line">stdin, stdout, stderr = ssh.exec_command(<span class="string">'df'</span>)</span><br><span class="line">print(stdout.read())</span><br><span class="line">ssh.close();</span><br><span class="line"></span><br><span class="line">执行命令 - 通过用户名和密码连接服务器</span><br></pre></td></tr></table></figure>
<h2 id="开源模块升级"><a href="#开源模块升级" class="headerlink" title="开源模块升级"></a>开源模块升级</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pip3 install --upgrade prompt_toolkit</span><br><span class="line">```　</span><br><span class="line"></span><br><span class="line"><span class="comment"># 包(Package)</span></span><br><span class="line">当你的模块文件越来越多，就需要对模块文件进行划分，比如把负责跟数据库交互的都放一个文件夹，把与页面交互相关的放一个文件夹，</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">像上面这样，一个文件夹管理多个模块文件，这个文件夹就被称为包</span><br><span class="line"></span><br><span class="line">包是目录级的（文件夹级），文件夹是用来组成py文件（包的本质就是一个包含__init__.py文件的目录）</span><br><span class="line"></span><br><span class="line">强调：</span><br><span class="line"></span><br><span class="line">　　<span class="number">1.</span> 在python3中，即使包下没有__init__.py文件，<span class="keyword">import</span> 包仍然不会报错，而在python2中，包下一定要有该文件，否则<span class="keyword">import</span> 包报错</span><br><span class="line"></span><br><span class="line">　　<span class="number">2.</span> 创建包的目的不是为了运行，而是被导入使用，记住，包只是模块的一种形式而已，包即模块</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">那不同包之间的模块互相导入呢？</span><br><span class="line"></span><br><span class="line">crm/views.py内容</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sayhi</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'hello world!'</span>)</span><br></pre></td></tr></table></figure>
<p>通过manage.py调用<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> crm <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line">views.sayhi()</span><br></pre></td></tr></table></figure></p>
<p>执行manage.py (注意这里用python2)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">python manage.py</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"manage.py"</span>, line <span class="number">6</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">from</span> crm <span class="keyword">import</span> views</span><br><span class="line">ImportError: No module named crm</span><br></pre></td></tr></table></figure>
<p>竟然说找不到模块，为什么呢？</p>
<p>包就是文件夹，但该文件夹下必须存在 <strong>init</strong>.py 文件, 该文件的内容可以为空。<strong>int</strong>.py用于标识当前文件夹是一个包。</p>
<p>在crm目录下创建一个空文件<strong>int</strong>.py ，再执行一次就可以了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ touch crm/__init__.py <span class="comment">#创建一个空文件</span></span><br><span class="line">python manage.py </span><br><span class="line">hello world!</span><br></pre></td></tr></table></figure></p>
<p>注意，在python3里，即使目录下没<strong>int</strong>.py文件也能创建成功，猜应该是解释器优化所致，但创建包还是要记得加上这个文件吧。</p>
<h2 id="跨模块导入"><a href="#跨模块导入" class="headerlink" title="跨模块导入"></a>跨模块导入</h2><p>目录结构如下</p>
<p>根据上面的结构，如何实现在crm/views.py里导入proj/settings.py模块？</p>
<p>直接导入的话，会报错，说找不到模块</p>
<p>是因为路径找不到，proj/settings.py 相当于是crm/views.py的父亲(crm)的兄弟(proj)的儿子(settings.py)，settings.py算是views.py的表弟啦，</p>
<p>在views.py里只能导入同级别兄弟模块代码，或者子级别包里的模块，根本不知道表弟表哥的存在。这可怎么办呢？</p>
<p>答案是添加环境变量，把父亲级的路径添加到sys.path中，就可以了，这样导入 就相当于从父亲级开始找模块了。</p>
<p>crm/views.py中添加环境变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys ,os</span><br><span class="line"></span><br><span class="line">BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__))) <span class="comment">#__file__的是打印当前被执行的模块.py文件相对路径，注意是相对路径</span></span><br><span class="line">print(BASE_DIR)</span><br><span class="line"></span><br><span class="line">sys.path.append(BASE_DIR)  </span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> proj <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sayhi</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'hello world!'</span>)</span><br><span class="line"></span><br><span class="line">print(settings.DATABASES)</span><br></pre></td></tr></table></figure>
<p>*注意；此时在proj/settings.py写上import urls会有问题么？</p>
<p>为什么呢？ 因为现在的程序入口是views.py , 你在settings.py导入import urls,其实相当于在crm目录找urls.py,而不是proj目录，</p>
<p>若想正常导入，要改成如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DATABASES= &#123;</span><br><span class="line">    <span class="string">'host'</span>:<span class="string">'localhost'</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> proj <span class="keyword">import</span> urls  <span class="comment">#proj这一层目录已经添加到sys.path里，可以直接找到</span></span><br><span class="line">print(<span class="string">'in proj/settings.py'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="绝对导入-amp-相对导入"><a href="#绝对导入-amp-相对导入" class="headerlink" title="绝对导入&amp;相对导入"></a>绝对导入&amp;相对导入</h2><p>在linux里可以通过cd ..回到上一层目录 ，cd ../.. 往上回2层，这个..就是指相对路径，在python里，导入也可以通过..</p>
<p>例如：</p>
<img src="/2018/10/01/2018100122/1.png">
<img src="/2018/10/01/2018100122/2.png">
<p>其实这两个错误的原因归根结底是一样的：在涉及到相对导入时，package所对应的文件夹必须正确的被python解释器视作package，而不是普通文件夹。否则由于不被视作package，无法利用package之间的嵌套关系实现python中包的相对导入。</p>
<p>文件夹被python解释器视作package需要满足两个条件：</p>
<p>文件夹中必须有<strong>init</strong>.py文件，该文件可以为空，但必须存在该文件。<br>不能作为顶层模块来执行该文件夹中的py文件（即不能作为主函数的入口）。<br>所以这个问题的解决办法就是，既然你在views.py里执行了相对导入，那就不要把views.py当作入口程序，可以通过上一级的manage.py调用views.py</p>
<img src="/2018/10/01/2018100122/3.png">
<p>但把from ..proj import settings 改成from . import models 后却执行成功了，为什么呢？</p>
<p>from .. import models会报错的原因是，这句代码会把manage.py所在的这一层视作package,</p>
<p>但实际上它不是，因为package不能是顶层入口代码，若想不出错，只能把manage.py往上再移一层。</p>
<img src="/2018/10/01/2018100122/4.png">
<p>一般在项目中经常使用的相对导入只有</p>
<p> from . import models （相对于从当前目录导入）</p>
<p><strong>有的事情总是还要继续，选择个方向确实重要，适合的事情和预想的会有偏差，希望可以有顺利的事情发生</strong></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/27/2018092722/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dynamic-Soul">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/27/2018092722/" itemprop="url">Python with 用法举例</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-27T22:02:06+08:00">2018-09-27</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python面向对象/" itemprop="url" rel="index"><span itemprop="name">Python面向对象</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="python-with用法举例"><a href="#python-with用法举例" class="headerlink" title="python with用法举例"></a>python with用法举例</h1><p>我们知道在操作文件对象的时候可以这么写</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'a.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">　　<span class="string">'代码块'</span></span><br></pre></td></tr></table></figure>
<p>上述叫做上下文管理协议，即with语句，为了让一个对象兼容with语句，必须在这个对象的类中声明<strong>enter</strong>和<strong>exit</strong>方法</p>
<p>使用举例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> shelve</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ShelveUtil</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    使用Shelve存储提取对象</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, file)</span>:</span></span><br><span class="line">        self.file_name = file</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">         存储对象</span></span><br><span class="line"><span class="string">        :param key:</span></span><br><span class="line"><span class="string">        :param value:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.file_obj[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">         获得对象</span></span><br><span class="line"><span class="string">        :param key:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> self.file_obj[key]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">load_keys</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        返回所有key</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> list(self.file_obj.keys())</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">del_obj</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        删除object</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">del</span> self.file_obj[key]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"enter"</span>)</span><br><span class="line">        self.file_obj = shelve.open(self.file_name)</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></span><br><span class="line">        print(<span class="string">"exit"</span>)</span><br><span class="line">        self.file_obj.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line"></span><br><span class="line">    a = &#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> ShelveUtil(<span class="string">'a.db'</span>) <span class="keyword">as</span> s:</span><br><span class="line">        s.save(<span class="string">'a'</span>, a)</span><br><span class="line">        print(s.load(<span class="string">'a'</span>))</span><br></pre></td></tr></table></figure>
<p>输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">enter</span><br><span class="line">&#123;<span class="string">'a'</span>: <span class="number">1</span>, <span class="string">'b'</span>: <span class="number">2</span>&#125;</span><br><span class="line">exit</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/26/2018092623/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dynamic-Soul">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/26/2018092623/" itemprop="url">Python单例模式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-26T23:24:35+08:00">2018-09-26</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python面向对象/" itemprop="url" rel="index"><span itemprop="name">Python面向对象</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h1><p><strong>单例模式（Singleton Pattern）</strong>是一种常用的软件设计模式，该模式的主要目的是确保某一个类只有一个实例存在。当你希望在整个系统中，某个类只能出现一个实例时，单例对象就能派上用场。</p>
<p>比如数据库连接读取配置文件，如果在程序运行期间，有很多地方都需要连接数据库，很多地方都需要创建数据库对象的实例，这就导致系统中存在多个 数据库实例对象，而这样会严重浪费内存资源，事实上，我们希望在程序运行期间只存在一个实例对象。</p>
<h1 id="实现单例模式的5种方式"><a href="#实现单例模式的5种方式" class="headerlink" title="实现单例模式的5种方式"></a>实现单例模式的5种方式</h1><h2 id="模块方式"><a href="#模块方式" class="headerlink" title="模块方式"></a>模块方式</h2><p>其实，Python 的模块就是天然的单例模式，因为模块在第一次导入时，会生成 .pyc 文件，当第二次导入时，就会直接加载 .pyc 文件，而不会再次执行模块代码。</p>
<p>因此，我们只需把相关的函数和数据定义在一个模块中，就可以获得一个单例对象了。如果我们真的想要一个单例类，可以考虑这样做：</p>
<p>mysingleton.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">foo</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">single = Singleton()</span><br></pre></td></tr></table></figure></p>
<p>　将上面的代码保存在文件 mysingleton.py 中，要使用时，直接在其他文件中导入此文件中的对象，这个对象即是单例模式的对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> demo.my_singleton <span class="keyword">import</span> single</span><br><span class="line"> </span><br><span class="line">single.foo()</span><br></pre></td></tr></table></figure>
<h2 id="使用装饰器"><a href="#使用装饰器" class="headerlink" title="使用装饰器"></a>使用装饰器</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Singleton</span><span class="params">(cls)</span>:</span></span><br><span class="line">    _instance = &#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_singleton</span><span class="params">(*args, **kargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> _instance:</span><br><span class="line">            _instance[cls] = cls(*args, **kargs)</span><br><span class="line">        <span class="keyword">return</span> _instance[cls]</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> _singleton</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x=<span class="number">0</span>)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">a1 = A(<span class="number">2</span>)</span><br><span class="line">a2 = A(<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line">print(id(a1), id(a2))</span><br><span class="line">　　</span><br><span class="line">```python</span><br><span class="line"><span class="comment">## 使用类</span></span><br><span class="line">```python</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">    __instance = <span class="keyword">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        print(x)</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">my_singleton</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls.__instance:</span><br><span class="line">            cls.__instance = cls(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls.__instance</span><br></pre></td></tr></table></figure>
<p>如果遇到多线程会出现问题　</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">    __instance = <span class="keyword">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        time.sleep(<span class="number">1</span>)  <span class="comment"># 加入干扰元素，造成多线程出现问题</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">my_singleton</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls.__instance:</span><br><span class="line">            cls.__instance = cls(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls.__instance</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">(arg)</span>:</span></span><br><span class="line">    obj = Singleton.my_singleton(arg)</span><br><span class="line">    print(obj)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=task, args=(i,))</span><br><span class="line">    t.start()</span><br><span class="line"> </span><br><span class="line">-------------------</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x00000000025D76D8</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000259FF28</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000001234A208</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000001234A1D0</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000001234A438</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000001234A630</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000001234A828</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000001234A978</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000001234A748</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000001234AAC8</span>&gt;</span><br><span class="line">```　　</span><br><span class="line"></span><br><span class="line">解决方法：加锁！未加锁部分并发执行,加锁部分串行执行,速度降低,但是保证了数据安全</span><br><span class="line">```python</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">    __instance = <span class="keyword">None</span></span><br><span class="line">    __instance_lock = threading.Lock()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        time.sleep(<span class="number">1</span>)  <span class="comment"># 加入干扰元素，造成多线程出现问题</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">my_singleton</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> cls.__instance_lock:  <span class="comment"># 加锁</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> cls.__instance:</span><br><span class="line">                cls.__instance = cls(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls.__instance</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">(arg)</span>:</span></span><br><span class="line">    obj = Singleton.my_singleton(arg)</span><br><span class="line">    print(obj)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=task, args=(i,))</span><br><span class="line">    t.start()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">----------------------</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000259FF28</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000259FF28</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000259FF28</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000259FF28</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000259FF28</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000259FF28</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000259FF28</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000259FF28</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000259FF28</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000259FF28</span>&gt;</span><br><span class="line">```　　</span><br><span class="line"></span><br><span class="line"><span class="comment">## 基于__new__方法实现（推荐使用）</span></span><br><span class="line">当我们实例化一个对象时，是先执行了类的__new__方法（我们没写时，默认调用object.__new__），实例化对象；然后再执行类的__init__方法，对这个对象进行初始化。</span><br><span class="line">```python</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">    _instance_lock = threading.Lock()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        time.sleep(<span class="number">1</span>)  <span class="comment"># 加入干扰元素，造成多线程出现问题</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(cls, <span class="string">'_instance'</span>):</span><br><span class="line">            <span class="keyword">with</span> cls._instance_lock:  <span class="comment"># 加锁</span></span><br><span class="line">                cls._instance = super(Singleton, cls).__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">(arg)</span>:</span></span><br><span class="line">    obj = Singleton(arg)</span><br><span class="line">    print(obj)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=task, args=(i,))</span><br><span class="line">    t.start()</span><br><span class="line"> </span><br><span class="line">----------------</span><br><span class="line"> </span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000257FF60</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000257FF60</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000257FF60</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000257FF60</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000257FF60</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000257FF60</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000257FF60</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000257FF60</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000257FF60</span>&gt;</span><br><span class="line">&lt;__main__.Singleton object at <span class="number">0x000000000257FF60</span>&gt;</span><br><span class="line">　　</span><br><span class="line"></span><br><span class="line"><span class="comment">## 基于metaclass方式实现</span></span><br><span class="line">```python</span><br><span class="line"><span class="number">1.</span>类由type创建，创建类时，type的__init__方法自动执行，类() 执行type的 __call__方法(类的__new__方法,类的__init__方法)</span><br><span class="line"><span class="number">2.</span>对象由类创建，创建对象时，类的__init__方法自动执行，对象()执行类的 __call__ 方法</span><br></pre></td></tr></table></figure>
<p>　实现单例<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonType</span><span class="params">(type)</span>:</span></span><br><span class="line">    _instance_lock = threading.Lock()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,class_name,class_bases,class_dic)</span>:</span></span><br><span class="line">        super(SingletonType, self).__init__(class_name,class_bases,class_dic)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(cls, <span class="string">'_instance'</span>):</span><br><span class="line">            <span class="keyword">with</span> cls._instance_lock:  <span class="comment"># 加锁</span></span><br><span class="line">                cls._instance = super(SingletonType, cls).__call__(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">my_singlton</span><span class="params">(metaclass=SingletonType)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        self.x = x</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span><span class="params">(arg)</span>:</span></span><br><span class="line">    obj = my_singlton(arg)</span><br><span class="line">    print(obj)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=task, args=(i,))</span><br><span class="line">    t.start()</span><br><span class="line"> </span><br><span class="line">--------------------------</span><br><span class="line">&lt;__main__.my_singlton object at <span class="number">0x00000000025CFF60</span>&gt;</span><br><span class="line">&lt;__main__.my_singlton object at <span class="number">0x00000000025CFF60</span>&gt;</span><br><span class="line">&lt;__main__.my_singlton object at <span class="number">0x00000000025CFF60</span>&gt;</span><br><span class="line">&lt;__main__.my_singlton object at <span class="number">0x00000000025CFF60</span>&gt;</span><br><span class="line">&lt;__main__.my_singlton object at <span class="number">0x00000000025CFF60</span>&gt;</span><br><span class="line">&lt;__main__.my_singlton object at <span class="number">0x00000000025CFF60</span>&gt;</span><br><span class="line">&lt;__main__.my_singlton object at <span class="number">0x00000000025CFF60</span>&gt;</span><br><span class="line">&lt;__main__.my_singlton object at <span class="number">0x00000000025CFF60</span>&gt;</span><br><span class="line">&lt;__main__.my_singlton object at <span class="number">0x00000000025CFF60</span>&gt;</span><br><span class="line">&lt;__main__.my_singlton object at <span class="number">0x00000000025CFF60</span>&gt;</span><br><span class="line">　　</span><br><span class="line">```python</span><br><span class="line"><span class="comment">## 单例模式使用</span></span><br><span class="line">　</span><br><span class="line">```python</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonDB</span><span class="params">(object)</span>:</span></span><br><span class="line">    _instance_lock = threading.Lock()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,host=<span class="string">'127.0.0.1'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">            port=<span class="number">3306</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">            user=<span class="string">'root'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">            password=<span class="string">'root'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">            database=<span class="string">'testdb'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">            charset=<span class="string">'utf8'</span>)</span>:</span></span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.password = password</span><br><span class="line">        self.user = user</span><br><span class="line">        self.database = database</span><br><span class="line">        self.charset = charset</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(SingletonDB, <span class="string">"_instance"</span>):</span><br><span class="line">            <span class="keyword">with</span> SingletonDB._instance_lock:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> hasattr(SingletonDB, <span class="string">"_instance"</span>):</span><br><span class="line">                    SingletonDB._instance = object.__new__(cls, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> SingletonDB._instance</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connect</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'connect db'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">db1 = SingletonDB()</span><br><span class="line">db2 = SingletonDB()</span><br><span class="line"> </span><br><span class="line">print(db1,db2)</span><br><span class="line">db1.connect()</span><br><span class="line">db2.connect()</span><br><span class="line"> </span><br><span class="line">----------------</span><br><span class="line">&lt;__main__.SingletonDB object at <span class="number">0x00000000025E76D8</span>&gt; &lt;__main__.SingletonDB object at <span class="number">0x00000000025E76D8</span>&gt;</span><br><span class="line">connect db</span><br><span class="line">connect db</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/25/2018092521/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dynamic-Soul">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/25/2018092521/" itemprop="url">Python元类</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-25T21:42:26+08:00">2018-09-25</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python面向对象/" itemprop="url" rel="index"><span itemprop="name">Python面向对象</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="背景（类也是对象）"><a href="#背景（类也是对象）" class="headerlink" title="背景（类也是对象）"></a>背景（类也是对象）</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">      <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line">f1=Foo() <span class="comment">#f1是通过Foo类实例化的对象</span></span><br></pre></td></tr></table></figure>
<p>python中一切皆是对象，类本身也是一个对象，当使用关键字class的时候，python解释器在加载class的时候就会创建一个对象(这里的对象指的是类而非类的实例)，</p>
<p>因而我们可以将类当作一个对象去使用，同样满足第一类对象的概念，可以：</p>
<p>把类赋值给一个变量</p>
<p>把类作为函数参数进行传递</p>
<p>把类作为函数的返回值</p>
<p>在运行时动态地创建类</p>
<p>上例可以看出f1是由Foo这个类产生的对象，而Foo本身也是对象，那它又是由哪个类产生的呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#type函数可以查看类型，也可以用来查看对象的类，二者是一样的</span></span><br><span class="line">print(type(f1)) <span class="comment"># 输出：&lt;class '__main__.Foo'&gt; 表示，obj 对象由Foo类创建</span></span><br><span class="line">print(type(Foo)) <span class="comment"># 输出：&lt;type 'type'&gt;</span></span><br><span class="line">```　　</span><br><span class="line"></span><br><span class="line"><span class="comment"># 什么是元类？</span></span><br><span class="line">元类是类的类，是类的模板</span><br><span class="line"></span><br><span class="line">元类是用来控制如何创建类的，正如类是创建对象的模板一样，而元类的主要目的是为了控制类的创建行为</span><br><span class="line"></span><br><span class="line">元类的实例化的结果为我们用<span class="class"><span class="keyword">class</span>定义的类，正如类的实例为对象<span class="params">(f1对象是Foo类的一个实例，Foo类是 type 类的一个实例)</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">type</span>是<span class="title">python</span>的一个内建元类，用来直接控制生成类，<span class="title">python</span>中任何<span class="title">class</span>定义的类其实都是<span class="title">type</span>类实例化的对象</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"># 创建类的两种方式</span></span><br><span class="line"><span class="class">方式一：使用<span class="title">class</span>关键字</span></span><br><span class="line"><span class="class">```<span class="title">python</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.age=age</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'%s is talking'</span> %self.name)</span><br><span class="line">```python</span><br><span class="line">　方式二：调用元类type（也可以自定义）来产生类</span><br><span class="line">```python</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fn</span><span class="params">(self, name=<span class="string">'world'</span>)</span>:</span> <span class="comment"># 先定义函数</span></span><br><span class="line">    print(<span class="string">'Hello, %s.'</span> % name)</span><br><span class="line"> </span><br><span class="line">Hello = type(<span class="string">'Hello'</span>, (object,), dict(hello=fn)) <span class="comment"># 创建Hello class</span></span><br><span class="line">print(Hello.__dict__)</span><br><span class="line"> </span><br><span class="line">print(Hello)</span><br><span class="line">print(type(Hello))</span><br><span class="line">print(isinstance(Hello,type))</span><br></pre></td></tr></table></figure>
<p>　我们看到，type 接收三个参数：</p>
<ul>
<li>第 1 个参数是字符串 ‘Hello’，表示类名</li>
<li>第 2 个参数是元组 (object, )，表示所有的父类</li>
<li>第 3 个参数是字典，表示定义属性和方法</li>
</ul>
<h1 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h1><h2 id="基于元类实现单例模式-比如数据库对象-实例化时参数都一样-就没必要重复产生对象-浪费内存"><a href="#基于元类实现单例模式-比如数据库对象-实例化时参数都一样-就没必要重复产生对象-浪费内存" class="headerlink" title="基于元类实现单例模式,比如数据库对象,实例化时参数都一样,就没必要重复产生对象,浪费内存"></a>基于元类实现单例模式,比如数据库对象,实例化时参数都一样,就没必要重复产生对象,浪费内存</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mysql</span><span class="params">(object)</span>:</span></span><br><span class="line">    __instance=<span class="keyword">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,host=<span class="string">'127.0.0.1'</span>,port=<span class="number">3306</span>)</span>:</span></span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">singleton</span><span class="params">(cls,*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls.__instance:</span><br><span class="line">            cls.__instance = cls(*args, **kwargs)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">m1 = Mysql()</span><br><span class="line">m2 = Mysql()</span><br><span class="line">print(m1 <span class="keyword">is</span> m2)  <span class="comment"># False</span></span><br><span class="line"> </span><br><span class="line">m3 = Mysql.singleton()</span><br><span class="line">m4 = Mysql.singleton()</span><br><span class="line"> </span><br><span class="line">print(m3 <span class="keyword">is</span> m4) <span class="comment"># True</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#实现方式二：元类的方式</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mymeta</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,class_name,class_bases,class_dic)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> class_name.istitle():</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'类名的首字母必须大写'</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> <span class="string">'__doc__'</span> <span class="keyword">not</span> <span class="keyword">in</span> class_dic <span class="keyword">or</span> <span class="keyword">not</span> class_dic[<span class="string">'__doc__'</span>].strip():</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'必须有注释，且注释不能为空'</span>)</span><br><span class="line"> </span><br><span class="line">        super(Mymeta,self).__init__(class_name,class_bases,class_dic)</span><br><span class="line">        self.__instance=<span class="keyword">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span> <span class="comment">#obj=Chinese('egon',age=18)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.__instance:</span><br><span class="line">            obj=object.__new__(self)</span><br><span class="line">            self.__init__(obj)</span><br><span class="line">            self.__instance=obj</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> self.__instance</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mysql</span><span class="params">(object,metaclass=Mymeta)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    mysql xxx</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.host=<span class="string">'127.0.0.1'</span></span><br><span class="line">        self.port=<span class="number">3306</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">obj1=Mysql()</span><br><span class="line">obj2=Mysql()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">print(obj1 <span class="keyword">is</span> obj2)</span><br></pre></td></tr></table></figure>
<p>##　案例：在元类中控制把自定义类的数据属性都变成大写<br>1.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mymeta</span><span class="params">(type)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, class_name,class_bases,class_dic)</span>:</span></span><br><span class="line">        super(Mymeta, self).__init__(class_name, class_bases, class_dic)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line">        obj = object.__new__(self) <span class="comment"># 创建对象</span></span><br><span class="line">        print(type(obj))</span><br><span class="line">        print(kwargs)</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> kwargs.items():</span><br><span class="line">            obj.__dict__[k.upper()] = v</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span><span class="params">(metaclass=Mymeta)</span>:</span></span><br><span class="line">    name = <span class="string">'alex'</span></span><br><span class="line">    age = <span class="string">'18'</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'%s is walking'</span> %self.name)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">p = Student(name=<span class="string">'egon'</span>,age=<span class="string">'19'</span>,score=<span class="string">'88'</span>)</span><br><span class="line">print(p.__dict__)</span><br><span class="line"><span class="comment">#-------------输出结果-----------</span></span><br><span class="line">&lt;<span class="class"><span class="keyword">class</span> '<span class="title">__main__</span>.<span class="title">Student</span>'&gt;</span></span><br><span class="line">&#123;'name': 'egon', 'age': '19', 'score': '88'&#125;</span><br><span class="line">&#123;<span class="string">'NAME'</span>: <span class="string">'egon'</span>, <span class="string">'AGE'</span>: <span class="string">'19'</span>, <span class="string">'SCORE'</span>: <span class="string">'88'</span>&#125;</span><br></pre></td></tr></table></figure>
<p>　2.<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mymetaclass</span><span class="params">(type)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls,name,bases,attrs)</span>:</span></span><br><span class="line">        <span class="comment"># 关键在于这，每一次实例化的时候，我们都只会返回这同一个instance对象</span></span><br><span class="line">        <span class="comment"># if not hasattr(cls, 'instance'):</span></span><br><span class="line">        update_attrs = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> k, v <span class="keyword">in</span> attrs.items():</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> callable(v) <span class="keyword">and</span> <span class="keyword">not</span> k.startswith(<span class="string">'__'</span>):</span><br><span class="line">                update_attrs[k.upper()] = v</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                update_attrs[k] = v</span><br><span class="line">        <span class="keyword">return</span> type.__new__(cls, name, bases, update_attrs)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chinese</span><span class="params">(metaclass=Mymetaclass)</span>:</span></span><br><span class="line">    country=<span class="string">'China'</span></span><br><span class="line">    tag=<span class="string">'Legend of the Dragon'</span> <span class="comment">#龙的传人</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'%s is walking'</span> %self.name)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">print(Chinese.__dict__)</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/24/2018092422/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dynamic-Soul">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/24/2018092422/" itemprop="url">未命名</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-24T22:17:24+08:00">2018-09-24</time>
            

            
            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<p>title:Python魔术方法<br>categories:Python面向对象</p>
<h2 id="tags-面向对象"><a href="#tags-面向对象" class="headerlink" title="tags:面向对象"></a>tags:面向对象</h2><h1 id="isinstance和issubclass"><a href="#isinstance和issubclass" class="headerlink" title="isinstance和issubclass"></a>isinstance和issubclass</h1><p>isinstance(obj,cls)检查是否obj是否是类 cls 的对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">obj = Foo()</span><br><span class="line">print(isinstance(obj, Foo)) <span class="comment"># True</span></span><br><span class="line">issubclass(sub, super)检查sub类是否是 super 类的派生类</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span><span class="params">(Foo)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line">print(issubclass(Bar,Foo)) <span class="comment"># True</span></span><br></pre></td></tr></table></figure>
<h1 id="二次加工标准类型-包装"><a href="#二次加工标准类型-包装" class="headerlink" title="二次加工标准类型(包装)"></a>二次加工标准类型(包装)</h1><p>包装：python为大家提供了标准数据类型，以及丰富的内置方法，其实在很多场景下我们都需要基于标准数据类型来定制我们自己的数据类型，</p>
<p>新增/改写方法，这就用到了我们刚学的继承/派生知识（其他的标准类型均可以通过下面的方式进行二次加工）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">List</span><span class="params">(list)</span>:</span><span class="comment">#继承list所有的属性，也可以派生出自己新的，比如append和mid</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">append</span><span class="params">(self,p_object)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> isinstance(p_object, int):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'must be int'</span>)</span><br><span class="line">        super().append(p_object)</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mid</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">'新增自己的属性'</span></span><br><span class="line">        index = len(self) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">return</span> self[index]</span><br><span class="line"> </span><br><span class="line">l=List([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">print(l)</span><br><span class="line">l.append(<span class="number">5</span>)</span><br><span class="line">print(l)</span><br><span class="line"><span class="comment"># l.append('1111111') #报错，必须为int类型</span></span><br><span class="line"> </span><br><span class="line">print(l.mid)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#其余的方法都继承list的</span></span><br><span class="line">l.insert(<span class="number">0</span>,<span class="number">-123</span>)</span><br><span class="line">print(l)</span><br><span class="line">l.clear()</span><br><span class="line">print(l)</span><br></pre></td></tr></table></figure></p>
<p>#　<strong>getattr</strong>与<strong>getattribute</strong><br>object.<strong>getattr</strong>(self, name)<br>当一般位置找不到attribute的时候，会调用getattr，返回一个值或AttributeError异常。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,filename,mode=<span class="string">'r'</span>,encoding=<span class="string">'utf-8'</span>)</span>:</span></span><br><span class="line">        self.file=open(filename,mode,encoding=encoding)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(self,line)</span>:</span></span><br><span class="line">        t=time.strftime(<span class="string">'%Y-%m-%d %T'</span>)</span><br><span class="line">        self.file.write(<span class="string">'%s %s'</span> %(t,line))</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'执行__getattr__item %s'</span> %item)</span><br><span class="line">        <span class="keyword">return</span> getattr(self.file,item)</span><br><span class="line"> </span><br><span class="line">f1=FileHandle(<span class="string">'b.txt'</span>,<span class="string">'w+'</span>)</span><br><span class="line">f1.write(<span class="string">'你好啊'</span>)</span><br><span class="line">f1.seek(<span class="number">0</span>) <span class="comment"># 执行__getattr__item seek</span></span><br><span class="line">print(f1.read()) <span class="comment"># 执行__getattr__item  read 2018-06-11 21:04:32 你好啊</span></span><br><span class="line">f1.close() <span class="comment"># 执行__getattr__item close&lt;br&gt;</span></span><br><span class="line">f1.xxxxxx <span class="comment">#不存在的属性访问，触发__getattr__</span></span><br></pre></td></tr></table></figure></p>
<p>object.<strong>getattribute</strong>(self, name)<br>无条件被调用，通过实例访问属性。如果class中定义了<strong>getattr</strong>()，则<strong>getattr</strong>()不会被调用（除非显示调用或引发AttributeError异常） </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        self.x=x</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'不管是否存在,我都会执行'</span>)</span><br><span class="line"> </span><br><span class="line">f1=Foo(<span class="number">10</span>)</span><br><span class="line">f1.x <span class="comment"># 不管是否存在,我都会执行</span></span><br><span class="line">f1.xxxxxx <span class="comment"># 不管是否存在,我都会执行</span></span><br></pre></td></tr></table></figure>
<p>二者同时出现</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        self.x=x</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'执行的是我'</span>)</span><br><span class="line">        <span class="comment"># return self.__dict__[item]</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'不管是否存在,我都会执行'</span>)</span><br><span class="line">        <span class="keyword">raise</span> AttributeError(<span class="string">'哈哈'</span>)</span><br><span class="line"> </span><br><span class="line">f1=Foo(<span class="number">10</span>)</span><br><span class="line">f1.x</span><br><span class="line">f1.xxxxxx</span><br><span class="line"> </span><br><span class="line"><span class="comment">#------输出结果-----------</span></span><br><span class="line">不管是否存在,我都会执行</span><br><span class="line">执行的是我</span><br><span class="line">不管是否存在,我都会执行</span><br><span class="line">执行的是我</span><br><span class="line"> </span><br><span class="line"><span class="comment">#当__getattribute__与__getattr__同时存在,只会执行__getattrbute__,除非__getattribute__在执行过程中抛出异常AttributeError</span></span><br></pre></td></tr></table></figure>
<h1 id="描述符-get-set-delete"><a href="#描述符-get-set-delete" class="headerlink" title="描述符(get,set,delete)"></a>描述符(<strong>get</strong>,<strong>set</strong>,<strong>delete</strong>)</h1><p>1 描述符是什么:描述符本质就是一个新式类,在这个新式类中,至少实现了<strong>get</strong>(),<strong>set</strong>(),<strong>delete</strong>()中的一个,这也被称为描述符协议 <strong>get</strong>():</p>
<p>   调用一个属性时,触发 <strong>set</strong>():为一个属性赋值时,触发 <strong>delete</strong>():采用del删除属性时,触发</p>
<p> 定义一个描述符<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#_*_coding:utf-8_*_</span></span><br><span class="line">__author__ = <span class="string">'Linhaifeng'</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span> <span class="comment">#在python3中Foo是新式类,它实现了三种方法,这个类就被称作一个描述符</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<p>2 描述符是干什么的:描述符的作用是用来代理另外一个类的属性的(必须把描述符定义成这个类的类属性，不能定义到构造函数中)</p>
<p>引子:描述符类产生的实例进行属性操作并不会触发三个方法的执行<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'触发get'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'触发set'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">'触发delete'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#包含这三个方法的新式类称为描述符,由这个类产生的实例进行属性的调用/赋值/删除,并不会触发这三个方法</span></span><br><span class="line">f1=Foo()</span><br><span class="line">f1.name=<span class="string">'egon'</span></span><br><span class="line">f1.name</span><br><span class="line"><span class="keyword">del</span> f1.name</span><br><span class="line"><span class="comment">#疑问:何时,何地,会触发这三个方法的执行</span></span><br></pre></td></tr></table></figure></p>
<p>描述符应用<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#描述符Str</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Str</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'Str调用'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'Str设置...'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">'Str删除...'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#描述符Int</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Int</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'Int调用'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'Int设置...'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">'Int删除...'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    name=Str()</span><br><span class="line">    age=Int()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age)</span>:</span> <span class="comment">#name被Str类代理,age被Int类代理,</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.age=age</span><br><span class="line"> </span><br><span class="line"><span class="comment">#何地？：定义成另外一个类的类属性</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#何时？：且看下列演示</span></span><br><span class="line"> </span><br><span class="line">p1=People(<span class="string">'alex'</span>,<span class="number">18</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#描述符Str的使用</span></span><br><span class="line">p1.name</span><br><span class="line">p1.name=<span class="string">'egon'</span></span><br><span class="line"><span class="keyword">del</span> p1.name</span><br><span class="line"> </span><br><span class="line"><span class="comment">#描述符Int的使用</span></span><br><span class="line">p1.age</span><br><span class="line">p1.age=<span class="number">18</span></span><br><span class="line"><span class="keyword">del</span> p1.age</span><br><span class="line"> </span><br><span class="line"><span class="comment">#我们来瞅瞅到底发生了什么</span></span><br><span class="line">print(p1.__dict__)</span><br><span class="line">print(People.__dict__)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#补充</span></span><br><span class="line">print(type(p1) == People) <span class="comment">#type(obj)其实是查看obj是由哪个类实例化来的</span></span><br><span class="line">print(type(p1).__dict__ == People.__dict__)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">Str设置...</span><br><span class="line">Int设置...</span><br><span class="line">Str调用</span><br><span class="line">Str设置...</span><br><span class="line">Str删除...</span><br><span class="line">Int调用</span><br><span class="line">Int设置...</span><br><span class="line">Int删除...</span><br><span class="line">&#123;&#125;</span><br><span class="line">&#123;<span class="string">'__module__'</span>: <span class="string">'__main__'</span>, <span class="string">'name'</span>: &lt;__main__.Str object at <span class="number">0x0000000014B0A470</span>&gt;, <span class="string">'age'</span>: &lt;__main__.Int object at <span class="number">0x0000000014B0A7B8</span>&gt;, <span class="string">'__init__'</span>: &lt;function People.__init__ at <span class="number">0x0000000014B2E1E0</span>&gt;, &lt;br&gt;<span class="string">'__dict__'</span>: &lt;attribute <span class="string">'__dict__'</span> of <span class="string">'People'</span> objects&gt;, <span class="string">'__weakref__'</span>: &lt;attribute <span class="string">'__weakref__'</span> of <span class="string">'People'</span> objects&gt;, <span class="string">'__doc__'</span>: <span class="keyword">None</span>&#125;</span><br><span class="line"><span class="keyword">True</span></span><br><span class="line"><span class="keyword">True</span></span><br></pre></td></tr></table></figure></p>
<p>　描述符使用</p>
<p>众所周知，python是弱类型语言，即参数的赋值没有类型限制，下面我们通过描述符机制来实现类型限制功能<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typed</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,expected_type)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.expected_type=expected_type</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'get---&gt;'</span>,instance,owner)</span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">return</span> instance.__dict__[self.name]</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'set---&gt;'</span>,instance,value)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value,self.expected_type):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'Expected %s'</span> %str(self.expected_type))</span><br><span class="line">        instance.__dict__[self.name]=value</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">'delete---&gt;'</span>,instance)</span><br><span class="line">        instance.__dict__.pop(self.name)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    name=Typed(<span class="string">'name'</span>,str)</span><br><span class="line">    age=Typed(<span class="string">'name'</span>,int)</span><br><span class="line">    salary=Typed(<span class="string">'name'</span>,float)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age,salary)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.age=age</span><br><span class="line">        self.salary=salary</span><br><span class="line"> </span><br><span class="line"><span class="comment"># p1=People(123,18,3333.3)</span></span><br><span class="line"><span class="comment"># p1=People('egon','18',3333.3)</span></span><br><span class="line">p1=People(<span class="string">'egon'</span>,<span class="number">18</span>,<span class="number">3333</span>)</span><br></pre></td></tr></table></figure></p>
<p>　　类的装饰器:无参<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(cls)</span>:</span></span><br><span class="line">    print(<span class="string">'类的装饰器开始运行啦------&gt;'</span>)</span><br><span class="line">    <span class="keyword">return</span> cls</span><br><span class="line"> </span><br><span class="line"><span class="meta">@decorate #无参:People=decorate(People)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age,salary)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.age=age</span><br><span class="line">        self.salary=salary</span><br><span class="line"> </span><br><span class="line">p1=People(<span class="string">'egon'</span>,<span class="number">18</span>,<span class="number">3333.3</span>)</span><br></pre></td></tr></table></figure></p>
<p>　　类的装饰器:有参<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">typeassert</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(<span class="string">'类的装饰器开始运行啦------&gt;'</span>,kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls</span><br><span class="line">    <span class="keyword">return</span> decorate</span><br><span class="line"><span class="meta">@typeassert(name=str,age=int,salary=float) #有参:1.运行typeassert(...)返回结果是decorate,此时参数都传给kwargs 2.People=decorate(People)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age,salary)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.age=age</span><br><span class="line">        self.salary=salary</span><br><span class="line"> </span><br><span class="line">p1=People(<span class="string">'egon'</span>,<span class="number">18</span>,<span class="number">3333.3</span>)</span><br></pre></td></tr></table></figure></p>
<p>　　通过反射和装饰器实现<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typed</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,expected_type)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.expected_type=expected_type</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'get---&gt;'</span>,instance,owner)</span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="keyword">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">return</span> instance.__dict__[self.name]</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'set---&gt;'</span>,instance,value)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value,self.expected_type):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'Expected %s'</span> %str(self.expected_type))</span><br><span class="line">        instance.__dict__[self.name]=value</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">'delete---&gt;'</span>,instance)</span><br><span class="line">        instance.__dict__.pop(self.name)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">typeassert</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(<span class="string">'类的装饰器开始运行啦------&gt;'</span>,kwargs)</span><br><span class="line">        <span class="keyword">for</span> name,expected_type <span class="keyword">in</span> kwargs.items():</span><br><span class="line">            setattr(cls,name,Typed(name,expected_type))</span><br><span class="line">        <span class="keyword">return</span> cls</span><br><span class="line">    <span class="keyword">return</span> decorate</span><br><span class="line"><span class="meta">@typeassert(name=str,age=int,salary=float) #有参:1.运行typeassert(...)返回结果是decorate,此时参数都传给kwargs 2.People=decorate(People)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,age,salary)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.age=age</span><br><span class="line">        self.salary=salary</span><br><span class="line"> </span><br><span class="line">print(People.__dict__)</span><br><span class="line">p1=People(<span class="string">'egon'</span>,<span class="number">18</span>,<span class="number">3333.3</span>)</span><br><span class="line">```　　</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># __setitem__,__getitem__,__delitem__</span></span><br><span class="line">```python</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(self.__dict__[item])</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        self.__dict__[key]=value</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        print(<span class="string">'del obj[key]时,我执行'</span>)</span><br><span class="line">        self.__dict__.pop(key)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'del obj.key时,我执行'</span>)</span><br><span class="line">        self.__dict__.pop(item)&lt;br&gt;</span><br><span class="line"><span class="comment">#通过字典方式访问</span></span><br><span class="line">f1=Foo(<span class="string">'sb'</span>)</span><br><span class="line">f1[<span class="string">'age'</span>]=<span class="number">18</span></span><br><span class="line">f1[<span class="string">'age1'</span>]=<span class="number">19</span></span><br><span class="line"><span class="keyword">del</span> f1.age1</span><br><span class="line"><span class="keyword">del</span> f1[<span class="string">'age'</span>]</span><br><span class="line">f1[<span class="string">'name'</span>]=<span class="string">'alex'</span></span><br><span class="line">print(f1.__dict__)</span><br></pre></td></tr></table></figure></p>
<h1 id="str-repr-format"><a href="#str-repr-format" class="headerlink" title="str,repr,format"></a><strong>str</strong>,<strong>repr</strong>,<strong>format</strong></h1><p>改变对象的字符串显示<strong>str</strong>,<strong>repr</strong><br>自定制格式化字符串<strong>format</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">format_dict=&#123;</span><br><span class="line">    <span class="string">'nat'</span>:<span class="string">'&#123;obj.name&#125;-&#123;obj.addr&#125;-&#123;obj.type&#125;'</span>,<span class="comment">#学校名-学校地址-学校类型</span></span><br><span class="line">    <span class="string">'tna'</span>:<span class="string">'&#123;obj.type&#125;:&#123;obj.name&#125;:&#123;obj.addr&#125;'</span>,<span class="comment">#学校类型:学校名:学校地址</span></span><br><span class="line">    <span class="string">'tan'</span>:<span class="string">'&#123;obj.type&#125;/&#123;obj.addr&#125;/&#123;obj.name&#125;'</span>,<span class="comment">#学校类型/学校地址/学校名</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">School</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,addr,type)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line">        self.addr=addr</span><br><span class="line">        self.type=type</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'School(%s,%s)'</span> %(self.name,self.addr)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'(%s,%s)'</span> %(self.name,self.addr)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__format__</span><span class="params">(self, format_spec)</span>:</span></span><br><span class="line">        <span class="comment"># if format_spec</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> format_spec <span class="keyword">or</span> format_spec <span class="keyword">not</span> <span class="keyword">in</span> format_dict:</span><br><span class="line">            format_spec=<span class="string">'nat'</span></span><br><span class="line">        fmt=format_dict[format_spec]</span><br><span class="line">        <span class="keyword">return</span> fmt.format(obj=self)</span><br><span class="line"> </span><br><span class="line">s1=School(<span class="string">'oldboy1'</span>,<span class="string">'北京'</span>,<span class="string">'私立'</span>)</span><br><span class="line">print(<span class="string">'from repr: '</span>,repr(s1))</span><br><span class="line">print(<span class="string">'from str: '</span>,str(s1))</span><br><span class="line">print(s1)  <span class="comment"># 调用__str__</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># -----输出结果-----------</span></span><br><span class="line"><span class="comment"># from repr:  School(oldboy1,北京)</span></span><br><span class="line"><span class="comment"># from str:  (oldboy1,北京)</span></span><br><span class="line"><span class="comment"># (oldboy1,北京)</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">str函数或者print函数---&gt;obj.__str__()</span></span><br><span class="line"><span class="string">repr或者交互式解释器---&gt;obj.__repr__()</span></span><br><span class="line"><span class="string">如果__str__没有被定义,那么就会使用__repr__来代替输出</span></span><br><span class="line"><span class="string">注意:这俩方法的返回值必须是字符串,否则抛出异常</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">print(format(s1,<span class="string">'nat'</span>))</span><br><span class="line">print(format(s1,<span class="string">'tna'</span>))</span><br><span class="line">print(format(s1,<span class="string">'tan'</span>))</span><br><span class="line"><span class="comment"># -----输出结果-----------</span></span><br><span class="line">oldboy1-北京-私立</span><br><span class="line">私立:oldboy1:北京</span><br><span class="line">私立/北京/oldboy1</span><br></pre></td></tr></table></figure></p>
<h1 id="slots"><a href="#slots" class="headerlink" title="slots"></a>slots</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">1.__slots__是什么:是一个类变量,变量值可以是列表,元祖,或者可迭代对象,也可以是一个字符串(意味着所有实例只有一个数据属性)</span></span><br><span class="line"><span class="string">2.引子:使用点来访问属性本质就是在访问类或者对象的__dict__属性字典(类的字典是共享的,而每个实例的是独立的)</span></span><br><span class="line"><span class="string">3.为何使用__slots__:字典会占用大量内存,如果你有一个属性很少的类,但是有很多实例,为了节省内存可以使用__slots__取代实例的__dict__</span></span><br><span class="line"><span class="string">当你定义__slots__后,__slots__就会为实例使用一种更加紧凑的内部表示。实例通过一个很小的固定大小的数组来构建,而不是为每个实例定义一个</span></span><br><span class="line"><span class="string">字典,这跟元组或列表很类似。在__slots__中列出的属性名在内部被映射到这个数组的指定小标上。使用__slots__一个不好的地方就是我们不能再给</span></span><br><span class="line"><span class="string">实例添加新的属性了,只能使用在__slots__中定义的那些属性名。</span></span><br><span class="line"><span class="string">4.注意事项:__slots__的很多特性都依赖于普通的基于字典的实现。另外,定义了__slots__后的类不再 支持一些普通类特性了,比如多继承。大多数情况下,你应该</span></span><br><span class="line"><span class="string">只在那些经常被使用到 的用作数据结构的类上定义__slots__比如在程序中需要创建某个类的几百万个实例对象 。</span></span><br><span class="line"><span class="string">关于__slots__的一个常见误区是它可以作为一个封装工具来防止用户给实例增加新的属性。尽管使用__slots__可以达到这样的目的,但是这个并不是它的初衷。           更多的是用来作为一个内存优化工具。</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">f1=Student()</span><br><span class="line">f1.name = <span class="string">'al'</span>  <span class="comment"># 绑定属性'name'</span></span><br><span class="line">f1.age = <span class="number">2</span>  <span class="comment"># 绑定属性'age'</span></span><br><span class="line">print(f1.__slots__) <span class="comment"># f1不再有__dict__</span></span><br><span class="line">print(f1.__dict__) <span class="comment"># 报错</span></span><br><span class="line">f1.score = <span class="number">99</span> <span class="comment"># 报错</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>:</span></span><br><span class="line">    __slots__=[<span class="string">'name'</span>,<span class="string">'age'</span>]</span><br><span class="line"> </span><br><span class="line">f1=Student()</span><br><span class="line">f1.name=<span class="string">'alex'</span></span><br><span class="line">f1.age=<span class="number">18</span></span><br><span class="line">print(f1.__slots__)  <span class="comment"># ['name', 'age']</span></span><br><span class="line"> </span><br><span class="line">f2=Student()</span><br><span class="line">f2.name=<span class="string">'egon'</span></span><br><span class="line">f2.age=<span class="number">19</span></span><br><span class="line">print(f2.__slots__)  <span class="comment"># ['name', 'age']</span></span><br><span class="line"> </span><br><span class="line">print(Student.__dict__)</span><br><span class="line"><span class="comment">#f1与f2都没有属性字典__dict__了,统一归__slots__管,节省内存</span></span><br></pre></td></tr></table></figure>
<h1 id="next和iter实现迭代器协议"><a href="#next和iter实现迭代器协议" class="headerlink" title="next和iter实现迭代器协议"></a><strong>next</strong>和<strong>iter</strong>实现迭代器协议</h1><p>简单模拟range，加上步长<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Range</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,n,stop,step)</span>:</span></span><br><span class="line">        self.n=n</span><br><span class="line">        self.stop=stop</span><br><span class="line">        self.step=step</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.n &gt;= self.stop:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        x=self.n</span><br><span class="line">        self.n+=self.step</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> Range(<span class="number">1</span>,<span class="number">7</span>,<span class="number">2</span>): <span class="comment">#</span></span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure></p>
<p>　斐波那契数列<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fib</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        self._a=<span class="number">0</span></span><br><span class="line">        self._b=<span class="number">1</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.n = <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.n &gt;= self.x:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        self._a,self._b=self._b,self._a + self._b</span><br><span class="line">        self.n += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> self._a</span><br><span class="line"> </span><br><span class="line">f1=Fib(<span class="number">10</span>)</span><br><span class="line"> </span><br><span class="line">print(f1.__next__())</span><br><span class="line">print(next(f1))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(next(f1))</span><br><span class="line">    <span class="keyword">except</span> StopIteration:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<h1 id="doc"><a href="#doc" class="headerlink" title="doc"></a><strong>doc</strong></h1><p>类的描述信息,该属性无法被继承<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="string">'我是描述信息'</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bar</span><span class="params">(Foo)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line">print(Foo.__doc__) <span class="comment"># 我是描述信息</span></span><br><span class="line">print(Bar.__doc__) <span class="comment"># None 该属性无法继承给子类</span></span><br></pre></td></tr></table></figure></p>
<h1 id="module和class"><a href="#module和class" class="headerlink" title="module和class"></a><strong>module</strong>和<strong>class</strong></h1><p><strong>module</strong> 表示当前操作的对象在那个模块</p>
<p><strong>class</strong> 表示当前操作的对象的类是什么</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.name = <span class="string">'alex'</span></span><br><span class="line"> </span><br><span class="line">obj = C()</span><br><span class="line">print(obj.__module__)    <span class="comment"># 输出 __main__，即：输出模块</span></span><br><span class="line">print(obj.__class__)     <span class="comment"># 输出 &lt;class '__main__.C'&gt;，即：输出类</span></span><br></pre></td></tr></table></figure>
<h1 id="del"><a href="#del" class="headerlink" title="del"></a><strong>del</strong></h1><p>析构方法，当对象在内存中被释放时，自动触发执行。</p>
<p>注：如果产生的对象仅仅只是python程序级别的（用户级），那么无需定义<strong>del</strong>,如果产生的对象的同时还会向操作系统发起系统调用，</p>
<p>即一个对象有用户级与内核级两种资源，比如（打开一个文件，创建一个数据库链接），则必须在清除对象的同时回收系统资源，这就用到了<strong>del</strong>。<br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'执行我啦'</span>)</span><br><span class="line"> </span><br><span class="line">f1=Foo()</span><br><span class="line"><span class="keyword">del</span> f1</span><br><span class="line">print(<span class="string">'-------&gt;'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#输出结果</span></span><br><span class="line">执行我啦</span><br><span class="line">-------&gt;</span><br></pre></td></tr></table></figure></p>
<h1 id="enter和exit"><a href="#enter和exit" class="headerlink" title="enter和exit"></a><strong>enter</strong>和<strong>exit</strong></h1><p>我们知道在操作文件对象的时候可以这么写</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'a.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">　　<span class="string">'代码块'</span></span><br></pre></td></tr></table></figure>
<p>上述叫做上下文管理协议，即with语句，为了让一个对象兼容with语句，必须在这个对象的类中声明<strong>enter</strong>和<strong>exit</strong>方法<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'出现with语句,对象的__enter__被触发,有返回值则赋值给as声明的变量'</span>)</span><br><span class="line">        <span class="comment"># return self</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></span><br><span class="line">        print(<span class="string">'with中代码块执行完毕时执行我啊'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> Open(<span class="string">'a.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(<span class="string">'=====&gt;执行代码块'</span>)</span><br><span class="line">    <span class="comment"># print(f,f.name)</span></span><br><span class="line"><span class="comment">#------------输出结果-------</span></span><br><span class="line">出现<span class="keyword">with</span>语句,对象的__enter__被触发,有返回值则赋值给<span class="keyword">as</span>声明的变量</span><br><span class="line">=====&gt;执行代码块</span><br><span class="line"><span class="keyword">with</span>中代码块执行完毕时执行我啊</span><br></pre></td></tr></table></figure></p>
<p>　<strong>exit</strong>()中的三个参数分别代表异常类型，异常值和追溯信息,with语句中代码块出现异常，则with后的代码都无法执行<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'出现with语句,对象的__enter__被触发,有返回值则赋值给as声明的变量'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></span><br><span class="line">        print(<span class="string">'with中代码块执行完毕时执行我啊'</span>)</span><br><span class="line">        print(exc_type)</span><br><span class="line">        print(exc_val)</span><br><span class="line">        print(exc_tb)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> Open(<span class="string">'a.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(<span class="string">'=====&gt;执行代码块'</span>)</span><br><span class="line">    <span class="keyword">raise</span> AttributeError(<span class="string">'***着火啦,救火啊***'</span>)</span><br><span class="line">print(<span class="string">'0'</span>*<span class="number">100</span>) <span class="comment">#-------------------------------&gt;不会执行</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># print(f,f.name)</span></span><br><span class="line"><span class="comment">#------------输出结果-------</span></span><br><span class="line"><span class="comment"># 出现with语句,对象的__enter__被触发,有返回值则赋值给as声明的变量</span></span><br><span class="line"><span class="comment"># =====&gt;执行代码块</span></span><br><span class="line"><span class="comment"># with中代码块执行完毕时执行我啊</span></span><br><span class="line"><span class="comment"># &lt;class 'AttributeError'&gt;</span></span><br><span class="line"><span class="comment"># ***着火啦,救火啊***</span></span><br><span class="line"><span class="comment"># &lt;traceback object at 0x00000000126EAB48&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>如果__exit()返回值为True,那么异常会被清空，就好像啥都没发生一样，with后的语句正常执行<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span>:</span></span><br><span class="line">        self.name=name</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'出现with语句,对象的__enter__被触发,有返回值则赋值给as声明的变量'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></span><br><span class="line">        print(<span class="string">'with中代码块执行完毕时执行我啊'</span>)</span><br><span class="line">        print(exc_type)</span><br><span class="line">        print(exc_val)</span><br><span class="line">        print(exc_tb)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> Open(<span class="string">'a.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(<span class="string">'=====&gt;执行代码块'</span>)</span><br><span class="line">    <span class="keyword">raise</span> AttributeError(<span class="string">'***着火啦,救火啊***'</span>)</span><br><span class="line">print(<span class="string">'0'</span>*<span class="number">10</span>) <span class="comment">#-------------------------------&gt;会执行</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># -------------输出结果------------------</span></span><br><span class="line"><span class="comment"># 出现with语句,对象的__enter__被触发,有返回值则赋值给as声明的变量</span></span><br><span class="line"><span class="comment"># =====&gt;执行代码块</span></span><br><span class="line"><span class="comment"># with中代码块执行完毕时执行我啊</span></span><br><span class="line"><span class="comment"># &lt;class 'AttributeError'&gt;</span></span><br><span class="line"><span class="comment"># ***着火啦,救火啊***</span></span><br><span class="line"><span class="comment"># &lt;traceback object at 0x00000000126EAB88&gt;&lt;br&gt;# 0000000000</span></span><br></pre></td></tr></table></figure></p>
<p>模拟Open　<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,file_name,mode,encoding=<span class="string">'utf-8'</span>)</span>:</span></span><br><span class="line">        self.file_name=file_name</span><br><span class="line">        self.mode = mode</span><br><span class="line">        self.encoding = encoding</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'enter'</span>)</span><br><span class="line">        self.f = open(self.file_name,self.mode,encoding=self.encoding)</span><br><span class="line">        <span class="keyword">return</span> self.f</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></span><br><span class="line">        print(<span class="string">"exit"</span>)</span><br><span class="line">        self.f.close()</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">True</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'执行的是我'</span>)</span><br><span class="line">        <span class="keyword">return</span> getattr(self.f, item)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">with</span> Open(<span class="string">'test.txt'</span>,<span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">'aadddda'</span>)</span><br><span class="line">```　　</span><br><span class="line"></span><br><span class="line"><span class="number">1.</span>使用<span class="keyword">with</span>语句的目的就是把代码块放入<span class="keyword">with</span>中执行，<span class="keyword">with</span>结束后，自动完成清理工作，无须手动干预</span><br><span class="line"></span><br><span class="line"><span class="number">2.</span>在需要管理一些资源比如文件，网络连接和锁的编程环境中，可以在__exit__中定制自动释放资源的机制，你无须再去关系这个问题，这将大有用处</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># __call__</span></span><br><span class="line">对象后面加括号，触发执行。</span><br><span class="line"></span><br><span class="line">注：构造方法的执行是由创建对象触发的，即：对象 = 类名() ；而对于 __call__ 方法的执行是由对象后加括号触发的，即：对象() 或者 类()()</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, *args, **kwargs)</span>:</span></span><br><span class="line"> </span><br><span class="line">        print(<span class="string">'__call__'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">obj = Foo() <span class="comment"># 执行 __init__</span></span><br><span class="line">obj()       <span class="comment"># 执行 __call__</span></span><br></pre></td></tr></table></figure></p>
<h1 id="new"><a href="#new" class="headerlink" title="new"></a><strong>new</strong></h1><p> 在基础类object中，<strong>new</strong>被定义成了一个静态方法，并且需要传递一个参数cls。cls表示需要实例化的类，此参数在实例化时由Python解析器自动提供。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'init'</span>)</span><br><span class="line">         </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'call __new__() is running. cls id is %s'</span> %id(cls))</span><br><span class="line">        r = super(Foo, cls).__new__(cls,*args, **kwargs)</span><br><span class="line">        print(<span class="string">'r_id is % s'</span> % id(r))</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line"> </span><br><span class="line">f = Foo()</span><br><span class="line">----------输出结果----------</span><br><span class="line">call __new__() <span class="keyword">is</span> running. cls id <span class="keyword">is</span> <span class="number">309410296</span></span><br><span class="line">r_id <span class="keyword">is</span> <span class="number">60819440</span></span><br><span class="line">init</span><br></pre></td></tr></table></figure></p>
<p>实例化对象f的时候，调用<strong>init</strong>()初始化之前，先调用了<strong>new</strong>()方法</p>
<p>产生的新对象 = object.<strong>new</strong>(继承object类的子类)</p>
<p><strong>new</strong>()必须要有返回值，返回实例化出来的实例，需要注意的是，可以return父类<strong>new</strong>()出来的实例，也可以直接将object的<strong>new</strong>()出来的实例返回。</p>
<p><strong>init</strong>()有一个参数self，该self参数就是<strong>new</strong>()返回的实例，<strong>init</strong>()在<strong>new</strong>()的基础上可以完成一些其它初始化的动作，<strong>init</strong>()不需要返回值。</p>
<p>若<strong>new</strong>()没有正确返回当前类cls的实例，那<strong>init</strong>()将不会被调用，即使是父类的实例也不行。</p>
<p>我们可以将类比作制造商，<strong>new</strong>()方法就是前期的原材料购买环节，<strong>init</strong>()方法就是在有原材料的基础上，加工，初始化商品环节。</p>
<h2 id="new-的作用"><a href="#new-的作用" class="headerlink" title="new 的作用"></a><strong>new</strong> 的作用</h2><p>依照Python官方文档的说法，<strong>new</strong>方法主要是当你继承一些不可变的class时(比如int, str, tuple)， 提供给你一个自定义这些类的实例化过程的途径。还有就是实现自定义的metaclass。<br>首先我们来看一下第一个功能，具体我们可以用int来作为一个例子：<br>假如我们需要一个永远都是正数的整数类型，通过集成int，我们可能会写出这样的代码<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PositiveInteger</span><span class="params">(int)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, value)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> super(PositiveInteger, cls).__new__(cls,abs(value))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">p = PositiveInteger(<span class="number">-3</span>)</span><br><span class="line">print(p)  <span class="comment"># 3</span></span><br></pre></td></tr></table></figure></p>
<p><strong>new</strong> 实现单例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="comment"># 关键在于这，每一次实例化的时候，我们都只会返回这同一个instance对象</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> hasattr(cls, <span class="string">'instance'</span>):</span><br><span class="line">            cls.instance = super(Singleton, cls).__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls.instance</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">obj1 = Singleton()</span><br><span class="line">obj2 = Singleton()</span><br><span class="line"> </span><br><span class="line">obj1.attr1 = <span class="string">'value1'</span></span><br><span class="line">print(obj1.attr1, obj2.attr1)</span><br><span class="line">print(obj1 <span class="keyword">is</span> obj2)</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/22/2018092222/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dynamic-Soul">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/22/2018092222/" itemprop="url">Python反射</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-22T22:41:33+08:00">2018-09-22</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python面向对象/" itemprop="url" rel="index"><span itemprop="name">Python面向对象</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是反射"><a href="#什么是反射" class="headerlink" title="什么是反射"></a>什么是反射</h1><p>反射的概念是由Smith在1982年首次提出的，主要是指程序可以访问、检测和修改它本身状态或行为的一种能力（自省）。</p>
<p>这一概念的提出很快引发了计算机科学领域关于应用反射性的研究。它首先被程序语言的设计领域所采用,并在Lisp和面向对象方面取得了成绩</p>
<h1 id="python面向对象中的反射："><a href="#python面向对象中的反射：" class="headerlink" title="python面向对象中的反射："></a>python面向对象中的反射：</h1><p>通过字符串的形式操作对象相关的属性。python中的一切事物都是对象（都可以使用反射）</p>
<p>四个可以实现自省的函数 下列方法适用于类和对象（一切皆对象，类本身也是一个对象）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">hasattr(object,name)</span><br><span class="line"><span class="comment"># 判断object中有没有一个name字符串对应的方法或属性</span></span><br><span class="line"> </span><br><span class="line">setattr(obj,<span class="string">'name'</span>,<span class="string">'al'</span>) <span class="comment">#obj.name='al'</span></span><br><span class="line"><span class="comment"># 参数是一个对象,一个字符串和一个任意值。字符串可能会列出一个现有的属性或一个新的属性。这个函数将值赋给属性的</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">print(getattr(obj,<span class="string">'name'</span>,<span class="keyword">None</span>))</span><br><span class="line"><span class="comment"># 参数是一个对象,一个字符串和一个默认值。如果obj中有属性name则打印self.name的值，否则打印None</span></span><br><span class="line"> </span><br><span class="line">delattr(obj,<span class="string">'age'</span>) <span class="comment">#del obj.age</span></span><br><span class="line">print(obj.__dict__)</span><br><span class="line"><span class="comment"># 参数是由一个对象(记住python中一切皆是对象)和一个字符串组成的。string参数必须是对象属性名之一。该函数删除该obj的一个由string指定的属性。</span></span><br></pre></td></tr></table></figure>
<h2 id="四个方法的使用演示"><a href="#四个方法的使用演示" class="headerlink" title="四个方法的使用演示"></a>四个方法的使用演示</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Room</span><span class="params">()</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,length, width, height)</span>:</span></span><br><span class="line">        self.length = length</span><br><span class="line">        self.width = width</span><br><span class="line">        self.height = height</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.length * self.width</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">volume</span><span class="params">(self)</span>:</span>  <span class="comment"># 求房间的体积的功能</span></span><br><span class="line">        <span class="keyword">return</span> self.length * self.width * self.high  <span class="comment"># 公式为：长 x 宽 x 高</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">r1 = Room(<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>)</span><br><span class="line"><span class="comment">#检测是否含有某属性</span></span><br><span class="line">print(hasattr(r1,<span class="string">'length'</span>))</span><br><span class="line">print(hasattr(r1,<span class="string">'area'</span>))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">#获取属性</span></span><br><span class="line">n=getattr(r1,<span class="string">'height'</span>)</span><br><span class="line">print(n)</span><br><span class="line">func=getattr(r1,<span class="string">'area'</span>)</span><br><span class="line">print(func())</span><br><span class="line"> </span><br><span class="line"><span class="comment"># getattr(r1,'aaaaaaaa') #报错</span></span><br><span class="line">print(getattr(r1,<span class="string">'aaaaaaaa'</span>,<span class="string">'不存在啊'</span>))</span><br><span class="line"> </span><br><span class="line"><span class="comment">#设置属性</span></span><br><span class="line">setattr(r1,<span class="string">'x'</span>,<span class="number">2</span>)</span><br><span class="line">setattr(r1,<span class="string">'show_x'</span>,<span class="keyword">lambda</span> self:self.height+self.x)</span><br><span class="line">print(r1.__dict__)</span><br><span class="line">print(r1.show_x(r1))</span><br><span class="line"> </span><br><span class="line"><span class="comment">#删除属性</span></span><br><span class="line">delattr(r1,<span class="string">'x'</span>)</span><br><span class="line">delattr(r1,<span class="string">'show_name'</span>)</span><br><span class="line">delattr(r1,<span class="string">'show_name111'</span>)<span class="comment">#不存在,则报错</span></span><br><span class="line"> </span><br><span class="line">print(r1.__dict__)</span><br></pre></td></tr></table></figure>
<h2 id="类也是对象"><a href="#类也是对象" class="headerlink" title="类也是对象"></a>类也是对象</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span><span class="params">(object)</span>:</span></span><br><span class="line"> </span><br><span class="line">    staticField = <span class="string">"old boy"</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.name = <span class="string">'wupeiqi'</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'func'</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'bar'</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">print(getattr(Foo,<span class="string">'staticField'</span>))</span><br><span class="line">print(getattr(Foo,<span class="string">'func'</span>))</span><br><span class="line">print(getattr(Foo,<span class="string">'bar'</span>))</span><br></pre></td></tr></table></figure>
<h2 id="反射当前模块成员"><a href="#反射当前模块成员" class="headerlink" title="反射当前模块成员"></a>反射当前模块成员</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">s1</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'s1'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">s2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> (<span class="string">'s2'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">this_module = sys.modules[__name__]</span><br><span class="line">print(this_module) <span class="comment"># &lt;module '__main__' from 'C:/路飞/第三模块/第一章面向对象/23 反射.py'&gt;</span></span><br><span class="line">print(hasattr(this_module, <span class="string">'s1'</span>)) <span class="comment"># True</span></span><br><span class="line">getattr(this_module, <span class="string">'s2'</span>)()  <span class="comment">#s2</span></span><br></pre></td></tr></table></figure>
<h1 id="为什么用反射之反射的好处"><a href="#为什么用反射之反射的好处" class="headerlink" title="为什么用反射之反射的好处"></a>为什么用反射之反射的好处</h1><p>好处一：实现可插拔机制</p>
<p>有俩程序员，一个lili，一个是egon，lili在写程序的时候需要用到egon所写的类，但是egon去跟女朋友度蜜月去了，还没有完成他写的类，lili想到了反射，使用了反射机制lili可以继续完成自己的代码，等egon度蜜月回来后再继续完成类的定义并且去实现lili想要的功能。</p>
<p>总之反射的好处就是，可以事先定义好接口，接口只有在被完成后才会真正执行，这实现了即插即用，这其实是一种‘后期绑定’，什么意思？即你可以事先把主要的逻辑写好（只定义接口），然后后期再去实现接口的功能<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># egon还没有实现全部功能</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FtpClient</span>:</span></span><br><span class="line">    <span class="string">'ftp客户端,但是还么有实现具体的功能'</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,addr)</span>:</span></span><br><span class="line">        print(<span class="string">'正在连接服务器[%s]'</span> %addr)</span><br><span class="line">        self.addr=addr</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 不影响lili的代码编写</span></span><br><span class="line"><span class="comment">#from module import FtpClient</span></span><br><span class="line">f1=FtpClient(<span class="string">'192.168.1.1'</span>)</span><br><span class="line"><span class="keyword">if</span> hasattr(f1,<span class="string">'get'</span>):</span><br><span class="line">    func_get=getattr(f1,<span class="string">'get'</span>)</span><br><span class="line">    func_get()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'----&gt;不存在此方法'</span>)</span><br><span class="line">    print(<span class="string">'处理其他的逻辑'</span>)</span><br></pre></td></tr></table></figure></p>
<h1 id="反射机制在实际的应用"><a href="#反射机制在实际的应用" class="headerlink" title="反射机制在实际的应用"></a>反射机制在实际的应用</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 考虑有这么一个场景，根据用户输入的url的不同，调用不同的函数，实现不同的操作，也就是一个url路由器的功能，</span></span><br><span class="line"><span class="comment"># 这在web框架里是核心部件之一。下面有一个精简版的示例：</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 首先，有一个WebUrl模块，它里面有几个函数，分别用于展示不同的页面，代码如下：</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WebUrl</span><span class="params">()</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"login页面！"</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"logout页面！"</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">home</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"主页面！"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 其次，有一个visit模块，作为程序入口，接受用户输入，展示相应的页面，代码如下：（这段代码是比较初级的写法）</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    inp = input(<span class="string">"请输入您想访问页面的url： "</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> inp == <span class="string">"login"</span>:</span><br><span class="line">        WebUrl().login()</span><br><span class="line">    <span class="keyword">elif</span> inp == <span class="string">"logout"</span>:</span><br><span class="line">        WebUrl().logout()</span><br><span class="line">    <span class="keyword">elif</span> inp == <span class="string">"home"</span>:</span><br><span class="line">        WebUrl().home()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"404"</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    run()</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 我们运行visit.py，输入：home，页面结果如下：</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 请输入您想访问页面的url： home</span></span><br><span class="line"><span class="comment"># 这是网站主页面！</span></span><br><span class="line"><span class="comment"># 这就实现了一个简单的WEB路由功能，根据不同的url，执行不同的函数，获得不同的页面。</span></span><br><span class="line"><span class="comment"># 然而，让我们考虑一个问题，如果WebUrl模块里有成百上千个函数呢(这非常正常)?。难道你在visit模块里写上成百上千个elif?显然这是不可能的！那么怎么破？</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span><span class="params">()</span>:</span></span><br><span class="line">    inp = input(<span class="string">"请输入您想访问页面的url： "</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> hasattr(WebUrl(), inp):</span><br><span class="line">        func = getattr(WebUrl(), inp)</span><br><span class="line">        func()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"404"</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/21/2018092123/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dynamic-Soul">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/21/2018092123/" itemprop="url">Python绑定方法与非绑定方法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-21T23:09:40+08:00">2018-09-21</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python面向对象/" itemprop="url" rel="index"><span itemprop="name">Python面向对象</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="绑定方法"><a href="#绑定方法" class="headerlink" title="绑定方法"></a>绑定方法</h1><p>绑定方法（绑定给谁，谁来调用就自动将它本身当作第一个参数传入）：</p>
<p>1.绑定到类的方法：用classmethod装饰器装饰的方法，类在使用时会将类本身当做参数传给类方法的第一个参数（即便是对象来调用也会将类当作第一个参数传入，python为我们内置了函数classmethod来把类中的函数定义成类方法</p>
<p>2.绑定到对象的方法：没有被任何装饰器装饰的方法。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#settings.py</span></span><br><span class="line">HOST=<span class="string">'127.0.0.1'</span></span><br><span class="line">PORT=<span class="number">3306</span></span><br><span class="line">DB_PATH=<span class="string">r'C:\Users\Administrator\PycharmProjects\test\面向对象编程\test1\db'</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#test.py</span></span><br><span class="line"><span class="keyword">import</span> settings</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySQL</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,host,port)</span>:</span></span><br><span class="line">        self.host=host</span><br><span class="line">        self.port=port</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_conf</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(cls)</span><br><span class="line">        <span class="keyword">return</span> cls(settings.HOST,settings.PORT)</span><br><span class="line"> </span><br><span class="line">print(MySQL.from_conf) <span class="comment">#&lt;bound method MySQL.from_conf of &lt;class '__main__.MySQL'&gt;&gt;</span></span><br><span class="line">conn=MySQL.from_conf()</span><br><span class="line"> </span><br><span class="line">conn.from_conf() <span class="comment">#对象也可以调用，但是默认传的第一个参数仍然是类</span></span><br></pre></td></tr></table></figure></p>
<h1 id="非绑定方法：用staticmethod装饰器装饰的方法"><a href="#非绑定方法：用staticmethod装饰器装饰的方法" class="headerlink" title="非绑定方法：用staticmethod装饰器装饰的方法"></a>非绑定方法：用staticmethod装饰器装饰的方法</h1><p>1.不与类或对象绑定，类和对象都可以调用，但是没有自动传值那么一说。就是一个普通工具而已<br>注意：与绑定到对象方法区分开，在类中直接定义的函数，没有被任何装饰器装饰的，都是绑定到对象的方法，可不是普通函数，对象调用该方法会自动传值，而staticmethod装饰的方法，不管谁来调用，都没有自动传值一说<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySQL</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,host,port)</span>:</span></span><br><span class="line">        self.id=self.create_id()</span><br><span class="line">        self.host=host</span><br><span class="line">        self.port=port</span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_id</span><span class="params">()</span>:</span> <span class="comment">#就是一个普通工具</span></span><br><span class="line">        m=hashlib.md5(str(time.time()).encode(<span class="string">'utf-8'</span>))</span><br><span class="line">        <span class="keyword">return</span> m.hexdigest()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">print(MySQL.create_id) <span class="comment">#&lt;function MySQL.create_id at 0x0000000001E6B9D8&gt; #查看结果为普通函数</span></span><br><span class="line">conn=MySQL(<span class="string">'127.0.0.1'</span>,<span class="number">3306</span>)</span><br><span class="line">print(conn.create_id) <span class="comment">#&lt;function MySQL.create_id at 0x00000000026FB9D8&gt; #查看结果为普通函数</span></span><br><span class="line">```　　</span><br><span class="line"></span><br><span class="line"><span class="comment"># classmethod与staticmethod的对比</span></span><br><span class="line">```python</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySQL</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,host,port)</span>:</span></span><br><span class="line">        self.host=host</span><br><span class="line">        self.port=port</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_conf</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> MySQL(settings.HOST,settings.PORT)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># @classmethod #哪个类来调用,就将哪个类当做第一个参数传入</span></span><br><span class="line">    <span class="comment"># def from_conf(cls):</span></span><br><span class="line">    <span class="comment">#     return cls(settings.HOST,settings.PORT)</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'就不告诉你'</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mariadb</span><span class="params">(MySQL)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'&lt;%s:%s&gt;'</span> %(self.host,self.port)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">m=Mariadb.from_conf()</span><br><span class="line">print(m) <span class="comment">#我们的意图是想触发Mariadb.__str__,但是结果触发了MySQL.__str__的执行，打印就不告诉你：</span></span><br></pre></td></tr></table></figure></p>
<h1 id="练习"><a href="#练习" class="headerlink" title="练习"></a>练习</h1><p>练习1：定义MySQL类</p>
<p>要求：</p>
<p>1.对象有id、host、port三个属性</p>
<p>2.定义工具create_id，在实例化时为每个对象随机生成id，保证id唯一</p>
<p>3.提供两种实例化方式，方式一：用户传入host和port 方式二：从配置文件中读取host和port进行实例化</p>
<p>4.为对象定制方法，save和get_obj_by_id，save能自动将对象序列化到文件中，文件路径为配置文件中DB_PATH,文件名为id号，<br>保存之前验证对象是否已经存在，若存在则抛出异常，;get_obj_by_id方法用来从文件中反序列化出对象<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> settings</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySQL</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,host,port)</span>:</span></span><br><span class="line">        self.id = self.create_id()</span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_id</span><span class="params">()</span>:</span></span><br><span class="line">        md5 = hashlib.md5()</span><br><span class="line">        md5.update(str(time.time()).encode())</span><br><span class="line">        <span class="keyword">return</span> md5.hexdigest()</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_conf</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls(settings.HOST,settings.PORT)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">save</span><span class="params">(self, obj)</span>:</span></span><br><span class="line">        file_name = os.path.join(settings.DB_PATH,self.id)</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(file_name):</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">'对象已经存在'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">with</span> open(file_name,<span class="string">'ab'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                pickle.dump(obj, f)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_obj_by_id</span><span class="params">(self)</span>:</span></span><br><span class="line">        file_name = os.path.join(settings.DB_PATH, self.id)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(file_name):</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">'对象不存在'</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">with</span> open(file_name, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">                <span class="keyword">return</span> pickle.load(f)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">a = MySQL(<span class="string">'localhost'</span>, <span class="number">3306</span>)</span><br><span class="line">a.save(a)</span><br><span class="line">print(a.get_obj_by_id().__dict__)</span><br><span class="line"> </span><br><span class="line">b = MySQL.from_conf()</span><br><span class="line">b.save(b)</span><br><span class="line">print(b.get_obj_by_id().__dict__)</span><br><span class="line"> </span><br><span class="line">&#123;<span class="string">'id'</span>: <span class="string">'dacc8f2036484d4dc558d195ce97fdca'</span>, <span class="string">'host'</span>: <span class="string">'localhost'</span>, <span class="string">'port'</span>: <span class="number">3306</span>&#125;</span><br><span class="line">&#123;<span class="string">'id'</span>: <span class="string">'544617a52646324c247dd7878fae7d4b'</span>, <span class="string">'host'</span>: <span class="string">'127.0.0.1'</span>, <span class="string">'port'</span>: <span class="number">3306</span>&#125;</span><br><span class="line"> </span><br><span class="line">a.save(a)</span><br><span class="line"><span class="comment">#    raise Exception('对象已经存在')</span></span><br><span class="line"><span class="comment"># Exception: 对象已经存在</span></span><br></pre></td></tr></table></figure></p>
<p>setting.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">HOST=<span class="string">'127.0.0.1'</span></span><br><span class="line">PORT=<span class="number">3306</span></span><br><span class="line">DB_PATH = os.path.dirname(os.path.abspath(__name__))</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/20/2018092022/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dynamic-Soul">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/20/2018092022/" itemprop="url">Python封装</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-20T22:12:27+08:00">2018-09-20</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python面向对象/" itemprop="url" rel="index"><span itemprop="name">Python面向对象</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是封装"><a href="#什么是封装" class="headerlink" title="什么是封装"></a>什么是封装</h1><p>在程序设计中，封装（Encapsulation）是对具体对象的一种抽象，即将某些部分隐藏起来，在程序外部看不到，其含义是其他程序无法调用。</p>
<p>要了解封装，离不开“私有化”，就是将类或者是函数中的某些属性限制在某个区域之内，外部无法调用。</p>
<h1 id="为什么要封装"><a href="#为什么要封装" class="headerlink" title="为什么要封装"></a>为什么要封装</h1><p>　　封装数据的主要原因是：保护隐私（把不想别人知道的东西封装起来）</p>
<p>　　封装方法的主要原因是：隔离复杂度（比如：电视机，我们看见的就是一个黑匣子，其实里面有很多电器元件，对于</p>
<p>用户来说，我们不需要清楚里面都有些元件，电视机把那些电器元件封装在黑匣子里，提供给用户是一个遥控器，</p>
<p>通过遥控器就能实现对电视机的操作。）</p>
<h2 id="python私有化"><a href="#python私有化" class="headerlink" title="python私有化"></a>python私有化</h2><p>Python中私有化的方法也比较简单，即在准备私有化的属性（包括方法、数据）名字前面加两个下划线即可。</p>
<p>类中所有双下划线开头的名称如<strong>x都会自动变形成：_类名</strong>x的形式：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    __N=<span class="number">0</span> <span class="comment">#类的数据属性就应该是共享的,但是语法上是可以把类的数据属性设置成私有的如__N,会变形为_A__N</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__X=<span class="number">10</span> <span class="comment">#变形为self._A__X</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__foo</span><span class="params">(self)</span>:</span> <span class="comment">#变形为_A__foo</span></span><br><span class="line">        print(<span class="string">'from A'</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bar</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__foo() <span class="comment">#只有在类内部才可以通过__foo的形式访问到.　　</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">print(A.__dict__)</span><br><span class="line"><span class="comment"># &#123;'__module__': '__main__', '_A__N': 0, '__init__': &lt;function A.__init__ at 0x00000000126B0E18&gt;,</span></span><br><span class="line"><span class="comment">#  '_A__foo': &lt;function A.__foo at 0x00000000126B0EA0&gt;,</span></span><br><span class="line"><span class="comment"># 'bar': &lt;function A.bar at 0x00000000126B0F28&gt;,</span></span><br><span class="line"><span class="comment"># '__dict__': &lt;attribute '__dict__' of 'A' objects&gt;, '__weakref__':</span></span><br><span class="line"><span class="comment"># &lt;attribute '__weakref__' of 'A' objects&gt;, '__doc__': None&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>这种自动变形的特点：</p>
<p>　　　　1、类中定义的<strong>x只能在内部使用，如self.</strong>x，引用的就是变形的结果。</p>
<p>　　　　2、这种变形其实正是针对外部的变形，在外部是无法通过__x这个名字访问到的。</p>
<p>　　　　3、在子类定义的<strong>x不会覆盖在父类定义的</strong>x，因为子类中变形成了：<em>子类名__x,而父类中变形成了：</em>父</p>
<p>类名__x，即双下滑线开头的属性在继承给子类时，子类是无法覆盖的。</p>
<p>这种变形需要注意的问题是：</p>
<p>　　1、这种机制也并没有真正意义上限制我们从外部直接访问属性，知道了类名和属性名就可以拼出名字：_类名__属</p>
<p>性，然后就可以访问了，如a._A__N</p>
<pre><code>2、变形的过程只在类的定义是发生一次,在定义后的赋值操作，不会变形
</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    __N=<span class="number">0</span> <span class="comment">#类的数据属性就应该是共享的,但是语法上是可以把类的数据属性设置成私有的如__N,会变形为_A__N</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__X = <span class="number">10</span>  <span class="comment"># 变形为self._A__X</span></span><br><span class="line"> </span><br><span class="line">a = A()</span><br><span class="line">print(a._A__N)  <span class="comment"># 0</span></span><br><span class="line">print(a._A__X)  <span class="comment"># 10</span></span><br><span class="line">print(A._A__N)  <span class="comment"># 0</span></span><br><span class="line">a.__N = <span class="number">15</span> <span class="comment"># 新增N的值，此时加__不会变形</span></span><br><span class="line">print(a.__dict__) <span class="comment"># 发现后面的N并没有变形</span></span><br><span class="line"><span class="comment">#&#123;'_A__X': 10, '__N': 15&#125;</span></span><br></pre></td></tr></table></figure>
<p>　　3、在继承中，父类如果不想让子类覆盖自己的方法，可以将方法定义为私有的<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span>  <span class="comment"># 这是正常情况</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fa</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"from A"</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.fa()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fa</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"from B"</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">b = B()</span><br><span class="line">b.test()</span><br><span class="line"><span class="comment"># --------输出结果 - ---------</span></span><br><span class="line"><span class="comment"># from B</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span>  <span class="comment"># 把fa定义成私有的，即__fa</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__fa</span><span class="params">(self)</span>:</span>  <span class="comment"># 在定义时就变形为_A__fa</span></span><br><span class="line">        print(<span class="string">"from A"</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.__fa()  <span class="comment"># 只会与自己所在的类为准,即调用_A__fa</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__fa</span><span class="params">(self)</span>:</span>  <span class="comment"># b调用的是test，跟这个没关系</span></span><br><span class="line">        print(<span class="string">"from B"</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">b = B()</span><br><span class="line">b.test()</span><br><span class="line"><span class="comment"># --------输出结果 - ---------</span></span><br><span class="line"><span class="comment"># from A</span></span><br></pre></td></tr></table></figure></p>
<h1 id="特性（property）"><a href="#特性（property）" class="headerlink" title="特性（property）"></a>特性（property）</h1><p>　1、什么是特性property</p>
<p>　　property是一种特殊的属性，访问它时会执行一段功能（函数）然后返回值（就是一个装饰器）</p>
<p>　　注意：被property装饰的属性会优先于对象的属性被使用，而被propery装饰的属性,分成三种：property、被装饰</p>
<p>的函数名.setter、被装饰的函数名.deleter（都是以装饰器的形式）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">room</span>:</span>  <span class="comment"># 定义一个房间的类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, length, width, high)</span>:</span></span><br><span class="line">        self.length = length  <span class="comment"># 房间的长</span></span><br><span class="line">        self.width = width  <span class="comment"># 房间的宽</span></span><br><span class="line">        self.high = high  <span class="comment"># 房间的高</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span><span class="params">(self)</span>:</span>  <span class="comment"># 求房间的平方的功能</span></span><br><span class="line">        <span class="keyword">return</span> self.length * self.width  <span class="comment"># 房间的面积就是：长x宽</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perimeter</span><span class="params">(self)</span>:</span>  <span class="comment"># 求房间的周长的功能</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * (self.length + self.width)  <span class="comment"># 公式为：（长 + 宽）x 2</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">volume</span><span class="params">(self)</span>:</span>  <span class="comment"># 求房间的体积的功能</span></span><br><span class="line">        <span class="keyword">return</span> self.length * self.width * self.high  <span class="comment"># 公式为：长 x 宽 x 高</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">r1 = room(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)  <span class="comment"># 实例化一个对象r1</span></span><br><span class="line">print(<span class="string">"r1.area："</span>, r1.area)  <span class="comment"># 可以像访问数据属性一样去访问area,会触发一个函数的执行,动态计算出一个值</span></span><br><span class="line">print(<span class="string">"r1.perimeter："</span>, r1.perimeter)  <span class="comment"># 同上，就不用像调用绑定方法一样，还得加括号，才能运行</span></span><br><span class="line">print(<span class="string">"r1.volume："</span>, r1.volume)  <span class="comment"># 同上，就像是把运算过程封装到一个函数内部，我们不管过程，只要有结果就行</span></span><br><span class="line">------------输出结果 - --------------</span><br><span class="line">r1.area： <span class="number">6</span></span><br><span class="line">r1.perimeter： <span class="number">10</span></span><br><span class="line">r1.volume： <span class="number">24</span></span><br></pre></td></tr></table></figure>
<p>　<strong>注意：此时的特性arear、perimeter和volume不能被赋值。</strong><br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">r1.area = <span class="number">10</span> <span class="comment">#为特性area赋值</span></span><br><span class="line">r1.perimeter = <span class="number">15</span> <span class="comment">#为特性perimeter赋值</span></span><br><span class="line">r1.volume = <span class="number">24</span> <span class="comment">#为特性volume赋值</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">抛出异常：</span></span><br><span class="line"><span class="string">    r1.area = 10 #第一个就抛异常了，后面的也一样</span></span><br><span class="line"><span class="string">AttributeError: can't set attribute</span></span><br></pre></td></tr></table></figure></p>
<p><strong>为什么要用property</strong></p>
<p>将一个类的函数定义成特性以后，对象再去使用的时候obj.name,根本无法察觉自己的name是执行了一个函数然后计算出来的，</p>
<p>这种特性的使用方式遵循了统一访问的原则</p>
<p>除此之外，看下<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">ps：面向对象的封装有三种方式:</span><br><span class="line">【public】</span><br><span class="line">这种其实就是不封装,是对外公开的</span><br><span class="line">【protected】</span><br><span class="line">这种封装方式对外不公开,但对朋友(friend)或者子类(形象的说法是“儿子”,但我不知道为什么大家 不说“女儿”,就像“parent”本来是“父母”的意思,但中文都是叫“父类”)公开</span><br><span class="line">【private】</span><br><span class="line">这种封装对谁都不公开</span><br><span class="line">``` </span><br><span class="line">```python</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,val)</span>:</span></span><br><span class="line">        self.__NAME=val <span class="comment">#将所有的数据属性都隐藏起来</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__NAME <span class="comment">#obj.name访问的是self.__NAME(这也是真实值的存放位置)</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">    @name.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self,value)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value,str):  <span class="comment">#在设定值之前进行类型检查</span></span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'%s must be str'</span> %value)</span><br><span class="line">        self.__NAME=value <span class="comment">#通过类型检查后,将值value存放到真实的位置self.__NAME</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">    @name.deleter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">'Can not delete'</span>)</span><br><span class="line"> </span><br><span class="line">f=Foo(<span class="string">'egon'</span>)</span><br><span class="line">print(f.name)  <span class="comment"># egon</span></span><br><span class="line">f.name = <span class="string">'alex'</span>  <span class="comment"># 修改属性name = 'alex'</span></span><br><span class="line">print(f.name)</span><br><span class="line"><span class="comment"># f.name=10 # 抛出异常'TypeError: 10 must be str'</span></span><br><span class="line"><span class="keyword">del</span> f.name  <span class="comment"># 抛出异常'TypeError: Can not delete'</span></span><br><span class="line">```　</span><br><span class="line"></span><br><span class="line"><span class="comment"># 封装与扩展性</span></span><br><span class="line">封装在于明确区分内外，使得类实现者可以修改封装内的东西而不影响外部调用者的代码；而外部使用用者只知道一个接口(函数)，</span><br><span class="line"></span><br><span class="line">只要接口（函数）名、参数不变，使用者的代码永远无需改变。这就提供一个良好的合作基础——或者说，只要接口这个基础约定不变，则代码改变不足为虑。</span><br><span class="line"></span><br><span class="line">```python</span><br><span class="line"><span class="comment">#类的设计者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">room</span>:</span> <span class="comment">#定义一个房间的类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,owner,length,width,high)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.owner = owner</span><br><span class="line">        self.__length = length <span class="comment">#房间的长</span></span><br><span class="line">        self.__width = width <span class="comment">#房间的宽</span></span><br><span class="line">        self.__high = high <span class="comment">#房间的高</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span><span class="params">(self)</span>:</span> <span class="comment">#求房间面积的功能</span></span><br><span class="line">        <span class="keyword">return</span> self.__length * self.__width <span class="comment">#对外提供的接口，隐藏了内部的实现细节，\</span></span><br><span class="line">                                            <span class="comment"># 此时我们想求的是房间的面积就是：长x宽</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 类的使用者</span></span><br><span class="line"><span class="comment"># 实例化对象通过接口，调用相关属性得到想要的值：</span></span><br><span class="line">r1 = room(<span class="string">"客厅"</span>,<span class="string">"egon"</span>,<span class="number">100</span>,<span class="number">50</span>,<span class="number">50</span>) <span class="comment">#实例化一个对象r1</span></span><br><span class="line">print(r1.area) <span class="comment">#通过接口使用（area），使用者得到了客厅的面积</span></span><br><span class="line"><span class="comment"># -------------输出结果--------------</span></span><br><span class="line"><span class="comment"># 5000 #得到了客厅的面积</span></span><br></pre></td></tr></table></figure></p>
<p>　扩展原有的代码，使功能增加：　</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#类的设计者，轻松的扩展了功能，而类的使用者完全不需要改变自己的代码</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">room</span>:</span> <span class="comment">#定义一个房间的类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,owner,length,width,high)</span>:</span></span><br><span class="line">        self.name = name <span class="comment">#房间名</span></span><br><span class="line">        self.owner = owner <span class="comment">#房子的主人</span></span><br><span class="line">        self.__length = length <span class="comment">#房间的长</span></span><br><span class="line">        self.__width = width <span class="comment">#房间的宽</span></span><br><span class="line">        self.__high = high <span class="comment">#房间的高</span></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span><span class="params">(self)</span>:</span> <span class="comment">#对外提供的接口，隐藏内部实现</span></span><br><span class="line">        <span class="keyword">return</span> self.__length * self.__width,\</span><br><span class="line">               self.__length * self.__width * self.__high <span class="comment">#此时我们增加了求体积,</span></span><br><span class="line">        <span class="comment"># 内部逻辑变了,只需增加这行代码就能简单实现,而且外部调用感知不到,仍然使</span></span><br><span class="line">        <span class="comment"># 用该方法，但是功能已经增加了</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 对于类的使用者，仍然在调用area接口的人来说，根本无需改动自己的代码，就可以用上新功能：</span></span><br><span class="line"><span class="comment">#类的使用者</span></span><br><span class="line">r1 = room(<span class="string">"客厅"</span>,<span class="string">"alex"</span>,<span class="number">10</span>,<span class="number">30</span>,<span class="number">10</span>) <span class="comment">#实例化一个对象r1</span></span><br><span class="line">print(r1.area) <span class="comment">#通过接口使用（area），使用者得到了客厅的面积</span></span><br><span class="line"><span class="comment"># --------------输出结果---------------</span></span><br><span class="line"><span class="comment"># (300, 3000) #得到了新增的功能的值</span></span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/19/2018091922/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dynamic-Soul">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/19/2018091922/" itemprop="url">Python多态和鸭子类型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-19T22:54:33+08:00">2018-09-19</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python面向对象/" itemprop="url" rel="index"><span itemprop="name">Python面向对象</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="多态与多态性"><a href="#多态与多态性" class="headerlink" title="多态与多态性"></a>多态与多态性</h1><p><strong>多态指的是一类事物有多种形态，（一个抽象类有多个子类，因而多态的概念依赖于继承）。</strong></p>
<p>　　比如：文件分为文本文件，可执行文件（在定义角度）</p>
<p>比如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">我们按下 F1 键这个动作：</span><br><span class="line"> </span><br><span class="line">如果当前在 Flash 界面下弹出的就是 AS <span class="number">3</span> 的帮助文档；</span><br><span class="line">如果当前在 Word 下弹出的就是 Word 帮助；</span><br><span class="line">在 Windows 下弹出的就是 Windows 帮助和支持。</span><br><span class="line">同一个事件发生在不同的对象上会产生不同的结果。</span><br><span class="line">　文件有多种形态：文本文件，可执行文件</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"><span class="comment"># 抽象类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span><span class="params">(metaclass=abc.ABCMeta)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self ,name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 继承File</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TxtFile</span><span class="params">(File)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'open txtFile %s'</span> % self.name)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 继承File</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExeFile</span><span class="params">(File)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'open ExeFile %s'</span> % self.name)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># （多态）</span></span><br><span class="line">f1 = TxtFile(<span class="string">'f1'</span>) <span class="comment">#实例化对象TxtFile类 f1</span></span><br><span class="line">f2 = ExeFile(<span class="string">'f2'</span>) <span class="comment">#实例化对象ExeFile类 f2</span></span><br><span class="line">f1.open()</span><br><span class="line">f2.open()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># ----------------输出结果-------------------</span></span><br><span class="line"><span class="comment"># open txtFile f1</span></span><br><span class="line"><span class="comment"># open ExeFile f2</span></span><br></pre></td></tr></table></figure>
<p>什么是多态性（请务必注意：多态与多态性是两种概念。）</p>
<p>　　多态性：同一种调用方式，不同的执行效果（多态性）（在调用角度）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span><span class="params">(metaclass=abc.ABCMeta)</span>:</span> <span class="comment">#同一类事物:动物</span></span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span><span class="params">(Animal)</span>:</span> <span class="comment"># 动物的形态:狗</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'say wangwang'</span>)</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pig</span><span class="params">(Animal)</span>:</span> <span class="comment"># 动物的形态:猪</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'say aoao'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span><span class="params">(Animal)</span>:</span><span class="comment"># 动物的形态:猫</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'say miao'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(animal)</span>:</span>  <span class="comment"># 定义一个函数，相当于一个接口，</span></span><br><span class="line">    animal.talk()  <span class="comment"># 传来不同的实例化对象，最后实现的结果也不一样</span></span><br><span class="line"><span class="comment"># 以下虽然对象不一样，但是调用的方法是一样的，这就是 多态性</span></span><br></pre></td></tr></table></figure>
<h2 id="为什么要用多态性（多态性的好处）"><a href="#为什么要用多态性（多态性的好处）" class="headerlink" title="为什么要用多态性（多态性的好处）"></a>为什么要用多态性（多态性的好处）</h2><p>其实大家从上面多态性的例子可以看出，我们并没有增加什么新的知识，也就是说python本身就是支持多态性的，这么做的好处是什么呢？</p>
<p>1.增加了程序的灵活性</p>
<p>　　以不变应万变，不论对象千变万化，使用者都是同一种形式去调用，如func(File)</p>
<p>2.增加了程序额可扩展性</p>
<p>　通过继承File类创建了一个新的类，使用者无需更改自己的代码，还是用func(File)去调用 　</p>
<h1 id="鸭子类型"><a href="#鸭子类型" class="headerlink" title="鸭子类型"></a>鸭子类型</h1><p>Python崇尚鸭子类型，即“当看到一只鸟走起来像鸭子、游泳起来像鸭子、叫起来也像鸭子，那么这只鸟就可以被称为鸭子。”</p>
<p>在鸭子类型中，关注的不是对象的类型本身，而是它是如何使用的。例如，在不使用鸭子类型的语言中，我们可以编写一个函数，它接受一个类型为鸭的对象，并调用它的走和叫方法。</p>
<p>在使用鸭子类型的语言中，这样的一个函数可以接受一个任意类型的对象，并调用它的走和叫方法。如果这些需要被调用的方法不存在，那么将引发一个运行时错误。</p>
<p>任何拥有这样的正确的走和叫方法的对象都可被函数接受的这种行为引出了以上表述，这种决定类型的方式因此得名。</p>
<p>例1：利用标准库中定义的各种‘与文件类似’的对象，尽管这些对象的工作方式像文件，但他们没有继承内置文件对象的方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"><span class="comment"># 抽象类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span><span class="params">(metaclass=abc.ABCMeta)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self ,name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @abc.abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 继承File</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TxtFile</span><span class="params">(File)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'open txtFile %s'</span> % self.name)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'read txtFile %s'</span> % self.name)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'write txtFile %s'</span> % self.name)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 继承File</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExeFile</span><span class="params">(File)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'open ExeFile %s'</span> % self.name)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'read ExeFile %s'</span> % self.name)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'write ExeFile %s'</span> % self.name)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 鸭子类型，没有继承File</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Disk</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'disk read'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'disk write'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(obj)</span>:</span></span><br><span class="line">    obj.read()</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span><span class="params">(obj)</span>:</span></span><br><span class="line">    obj.write()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">read(Disk())</span><br><span class="line">read(ExeFile(<span class="string">'f1'</span>))</span><br><span class="line"> </span><br><span class="line">write(Disk())</span><br><span class="line">write(ExeFile(<span class="string">'f2'</span>))</span><br></pre></td></tr></table></figure>
<p>　例2：序列类型有多种形态：字符串，列表，元组，但他们直接没有直接的继承关系<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#str,list,tuple都是序列类型</span></span><br><span class="line">s=str(<span class="string">'hello'</span>)</span><br><span class="line">l=list([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>])</span><br><span class="line">t=tuple((<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>))</span><br><span class="line"> </span><br><span class="line"><span class="comment">#我们可以在不考虑三者类型的前提下使用s,l,t</span></span><br><span class="line">s.__len__()</span><br><span class="line">l.__len__()</span><br><span class="line">t.__len__()</span><br><span class="line"> </span><br><span class="line">len(s)</span><br><span class="line">len(l)</span><br><span class="line">len(t)</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/09/18/2018091822/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Mr.Q">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dynamic-Soul">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/09/18/2018091822/" itemprop="url">异常处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-18T22:35:51+08:00">2018-09-18</time>
            

            
            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Python面向对象/" itemprop="url" rel="index"><span itemprop="name">Python面向对象</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="什么是异常"><a href="#什么是异常" class="headerlink" title="什么是异常"></a>什么是异常</h1><p>异常就是程序运行时发生错误的信号（在程序出现错误时，则会产生一个异常，若程序没有处理它，则会抛出该异常，程序的运行也随之终止）。</p>
<p>在python中,错误触发的异常如下</p>
<img src="/2018/09/18/2018091822/1.png">
<p>而错误分成两种</p>
<p>1.语法错误：（这种错误，根本过不了python解释器的语法检测，必须在程序执行前就改正）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#语法错误示范一</span></span><br><span class="line"><span class="keyword">if</span></span><br><span class="line"><span class="comment">#语法错误示范二</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="comment">#语法错误示范三</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line"><span class="class">    <span class="title">pass</span></span></span><br><span class="line"><span class="class">#语法错误示范四</span></span><br><span class="line"><span class="class"><span class="title">print</span><span class="params">(haha)</span></span></span><br><span class="line"><span class="class">```　　</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">2.逻辑错误：比如用户输入的不合适等一系列错误</span></span><br><span class="line"><span class="class">```<span class="title">python</span></span></span><br><span class="line"><span class="class">#<span class="title">TypeError</span>:</span>int类型不可迭代</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">3</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="comment">#ValueError</span></span><br><span class="line">num=input(<span class="string">"&gt;&gt;: "</span>) <span class="comment">#输入hello</span></span><br><span class="line">int(num)</span><br><span class="line"> </span><br><span class="line"><span class="comment">#NameError</span></span><br><span class="line">aaa</span><br><span class="line"> </span><br><span class="line"><span class="comment">#IndexError</span></span><br><span class="line">l=[<span class="string">'egon'</span>,<span class="string">'aa'</span>]</span><br><span class="line">l[<span class="number">3</span>]</span><br><span class="line"> </span><br><span class="line"><span class="comment">#KeyError</span></span><br><span class="line">dic=&#123;<span class="string">'name'</span>:<span class="string">'egon'</span>&#125;</span><br><span class="line">dic[<span class="string">'age'</span>]</span><br><span class="line"> </span><br><span class="line"><span class="comment">#AttributeError</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span><span class="keyword">pass</span></span><br><span class="line">Foo.x</span><br><span class="line"> </span><br><span class="line"><span class="comment">#ZeroDivisionError:无法完成计算</span></span><br><span class="line">res1=<span class="number">1</span>/<span class="number">0</span></span><br><span class="line">res2=<span class="number">1</span>+<span class="string">'str</span></span><br></pre></td></tr></table></figure></p>
<h1 id="异常的种类"><a href="#异常的种类" class="headerlink" title="异常的种类"></a>异常的种类</h1><p>在python中不同的异常可以用不同的类型（python中统一了类与类型，类型即类）去标识，一个异常标识一种错误</p>
<p>所有错误类型都继承自BaseException</p>
<p><a href="https://docs.python.org/3/library/exceptions.html#exception-hierarchy" target="_blank" rel="noopener">https://docs.python.org/3/library/exceptions.html#exception-hierarchy</a></p>
<img src="/2018/09/18/2018091822/2.png">
<h1 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h1><p>为了保证程序的健壮性与容错性，即在遇到错误时程序不会崩溃，我们需要对异常进行处理，</p>
<p><strong>如果错误发生的条件是可预知的，我们需要用if进行处理：在错误发生之前进行预防</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    age=input(<span class="string">'&gt;&gt;: '</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> age.isdigit(): <span class="comment"># 只有在age为字符串形式的整数时,下列代码才不会出错,该条件是可预知的</span></span><br><span class="line">        age=int(age)</span><br><span class="line">        <span class="keyword">if</span> age &gt; <span class="number">18</span>:</span><br><span class="line">            print(<span class="string">'you are adult'</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p><strong>如果错误发生的条件是不可预知的，则需要用到try…except：在错误发生之后进行处理</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span><span class="params">(n)</span>:</span></span><br><span class="line">    c = <span class="number">0</span></span><br><span class="line">    i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; n+<span class="number">1</span>:</span><br><span class="line">        print(<span class="string">'&#123;&#125; += &#123;&#125;'</span>.format(c, i))</span><br><span class="line">        c += i</span><br><span class="line">        <span class="keyword">yield</span> c</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">f = sum(<span class="number">10</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> <span class="keyword">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        print(next(f))</span><br><span class="line">    <span class="keyword">except</span> StopIteration <span class="keyword">as</span> e:</span><br><span class="line">        print(<span class="string">'Generator return value:'</span>, e.value)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<h1 id="try-except…详细用法"><a href="#try-except…详细用法" class="headerlink" title="try..except…详细用法"></a>try..except…详细用法</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    suite1          <span class="comment">#测试语句块</span></span><br><span class="line"><span class="keyword">except</span> exception1:</span><br><span class="line">    suite2          <span class="comment">#如果测试语句suite1中发生exception1异常时执行</span></span><br><span class="line"><span class="keyword">except</span> (exception2,exception3):</span><br><span class="line">    suite3          <span class="comment">#如果测试语句suite1中发生元组中任意异常时执行</span></span><br><span class="line"><span class="keyword">except</span> exception4 <span class="keyword">as</span> reason:    <span class="comment">#as把异常的原因赋值给reason</span></span><br><span class="line">    suite4          <span class="comment">#如果测试语句suite1发生exception4的异常时执行</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    suite5          <span class="comment">#如果测试语句suite1发生异常在所列出的异常之外时执行</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    suite5          <span class="comment">#如果测试语句块suite1中没有发生异常时执行</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    suit6           <span class="comment">#不管测试语句suite1中又没有发生异常都会执行</span></span><br><span class="line">     </span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">注意：中间的except，else，finally都是可选的,但至少有一个，不然try就没有意义了，根据实际中的需求来选择。</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="1-异常类只能用来处理指定的异常情况，如果非指定异常则无法处理"><a href="#1-异常类只能用来处理指定的异常情况，如果非指定异常则无法处理" class="headerlink" title="1.异常类只能用来处理指定的异常情况，如果非指定异常则无法处理"></a>1.异常类只能用来处理指定的异常情况，如果非指定异常则无法处理</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">'hello'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    int(s1)</span><br><span class="line"><span class="keyword">except</span> IndexError <span class="keyword">as</span> e: <span class="comment"># 未捕获到异常，程序直接报错</span></span><br><span class="line">    <span class="keyword">print</span> e</span><br></pre></td></tr></table></figure>
<h2 id="2-多分支"><a href="#2-多分支" class="headerlink" title="2.多分支"></a>2.多分支</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">'hello'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    int(s1)</span><br><span class="line"><span class="keyword">except</span> IndexError <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line"><span class="keyword">except</span> KeyError <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br></pre></td></tr></table></figure>
<h2 id="3-万能异常Exception"><a href="#3-万能异常Exception" class="headerlink" title="3.万能异常Exception"></a>3.万能异常Exception</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">'hello'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    int(s1)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br></pre></td></tr></table></figure>
<h2 id="4-也可以在多分支后来一个Exception"><a href="#4-也可以在多分支后来一个Exception" class="headerlink" title="4.也可以在多分支后来一个Exception　"></a>4.也可以在多分支后来一个Exception　</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">'hello'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    int(s1)</span><br><span class="line"><span class="keyword">except</span> IndexError <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line"><span class="keyword">except</span> KeyError <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br></pre></td></tr></table></figure>
<h2 id="5-主动触发异常"><a href="#5-主动触发异常" class="headerlink" title="5.主动触发异常"></a>5.主动触发异常</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">10</span></span><br><span class="line"><span class="keyword">if</span> a &lt; <span class="number">18</span>:</span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">'值错误'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="6-如果抛出父类异常，在子类不会再获取"><a href="#6-如果抛出父类异常，在子类不会再获取" class="headerlink" title="6.如果抛出父类异常，在子类不会再获取"></a>6.如果抛出父类异常，在子类不会再获取</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#注意：如果抛出父类异常，在子类不会再获取，如下：</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    fun()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">raise</span> Exception</span><br><span class="line"><span class="keyword">except</span> ImportError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">raise</span> ImportError</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">     </span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">在上面的例子中，下面的ImportError就不会被抛出，应为ImportError继承Exception，但是可以把Exception放在后面是可以的</span></span><br><span class="line"><span class="string">e可以得到系统给出的报错信息</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="7-自定义异常"><a href="#7-自定义异常" class="headerlink" title="7.自定义异常"></a>7.自定义异常</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyException</span><span class="params">(BaseException)</span>:</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,msg)</span>:</span></span><br><span class="line">        super().__init__()</span><br><span class="line">        self.msg = msg</span><br><span class="line">         </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.msg</span><br><span class="line">   </span><br><span class="line">a =<span class="number">88</span></span><br><span class="line"><span class="keyword">if</span> a&gt;<span class="number">10</span>:</span><br><span class="line">    <span class="keyword">raise</span> MyException(<span class="string">'抛出我的异常'</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Networkerror</span><span class="params">(RuntimeError)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, msg)</span>:</span></span><br><span class="line">        self.msg = msg</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">raise</span> Networkerror(<span class="string">"Bad hostname"</span>)</span><br><span class="line"><span class="keyword">except</span> Networkerror <span class="keyword">as</span> e:</span><br><span class="line">    print(e)</span><br></pre></td></tr></table></figure>
<h2 id="8-断言-assert-条件"><a href="#8-断言-assert-条件" class="headerlink" title="8.断言:assert 条件"></a>8.断言:assert 条件</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">测试表示式，其返回值为假，就会触发异常</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">assert</span> <span class="number">1</span>==<span class="number">1</span>     <span class="comment">#没有返回值</span></span><br><span class="line"><span class="keyword">assert</span> <span class="number">1</span>&lt;<span class="number">2</span>       <span class="comment">#没有返回值</span></span><br><span class="line"><span class="keyword">assert</span> <span class="number">1</span>==<span class="number">2</span>     <span class="comment">#返回AssertionError</span></span><br></pre></td></tr></table></figure>
<h2 id="9-总结异常"><a href="#9-总结异常" class="headerlink" title="9.总结异常"></a>9.总结异常</h2><p>1：把错误处理和真正的工作分开来</p>
<p>2：代码更易组织，更清晰，复杂的工作任务更容易实现；</p>
<p>3：毫无疑问，更安全了，不至于由于一些小的疏忽而使程序意外崩溃了；</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.gif"
                alt="Mr.Q" />
            
              <p class="site-author-name" itemprop="name">Mr.Q</p>
              <p class="site-description motion-element" itemprop="description">我希望时间没有流走，世界还停在过去，昏黄的光还照在旧日的路上，我刚刚走过，恰与你们相识。</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">88</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.Q</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Gemini</a> v6.0.6</div>




<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共134.7k字</span>
</div>
        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.0.6"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.0.6"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.0.6"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.0.6"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.0.6"></script>



  



	





  





  










  





  

  

  

  

  
  

  

  

  

  


  
</body>
</html>
